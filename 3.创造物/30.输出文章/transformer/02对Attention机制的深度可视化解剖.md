æ‰¿æ¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œä¸ç®¡æ˜¯ä¸€å£æ°”è¾“å…¥ä¸€ä¸ªå¥å­ï¼Œè¿˜æ˜¯ä¸€ä¸ªå­—ä¸€ä¸ªå­—åœ°è¾“å…¥ï¼Œ

ä¹‹å‰çš„RNN/LSTM ä¸ç®¡é‚£äº›ï¼Œç»Ÿç»Ÿéƒ½æ˜¯**æŒ‰é¡ºåºè¯»å…¥**çš„ã€‚

å¤¸å¼ æ¥è¯´ï¼Œä¸€ä¸ªå­—è¯»1ç§’ã€‚ä¸€ä¸ª10å­—é•¿çš„å¥å­é‚£å°±å¾—è¯»10ç§’ï¼Œç„¶åå¾—åˆ°åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ¯ä¸ªè¯çš„è¯å‘é‡ï¼Œæ‹¼æ¥åå¾—åˆ°å¥å­å‘é‡ã€‚

æˆ‘ä»¬èƒ½ä¸èƒ½è®¾è®¡ä¸€ç§å…¨æ–°çš„æœºåˆ¶ï¼Œå½»åº•æŠ›å¼ƒâ€œå¾ªåºæ¸è¿›â€çš„æ¨¡å¼ï¼Ÿ

è®©æ¨¡å‹èƒ½å¤Ÿâ€œ**ä¸€çœ¼çœ‹å°½â€** æ‰€æœ‰è¯ï¼Œåœ¨**ä¸€ä¸ªè®¡ç®—æ­¥éª¤**å†…ï¼Œå°±å¾—åˆ°èåˆäº†å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ã€å…¨æ–°çš„è¯å‘é‡ï¼Ÿ

**æ¢è¨€ä¹‹ï¼Œä¸€ä¸ªè€—æ—¶10ç§’æ‰èƒ½è¯»å®Œçš„å¥å­ï¼Œæˆ‘ä»¬èƒ½è®©æ¨¡å‹åœ¨1ç§’å†…å°±â€œè¯»æ‡‚â€å—ï¼Ÿ**

**Attentionæœºåˆ¶ï¼Œæ­£æ˜¯ä¸ºå›ç­”è¿™ä¸ªé—®é¢˜è€Œç”Ÿã€‚**
# attentionæœºåˆ¶
## ç›´è§‰æ€§å»ºç«‹

å‡å¦‚è¯´ï¼Œä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½ç ”ç©¶ç”Ÿï¼Œä¸ºäº†å†™ä¸€ç¯‡å…³äºaiçš„è®ºæ–‡ï¼Œä½ æ¥åˆ°å­¦æ ¡å›¾ä¹¦é¦†ã€‚ä½†å›¾ä¹¦é¦†å¥½å¤§ï¼Œæœ‰æˆåƒä¸Šä¸‡æœ¬ä¹¦ï¼Œå„ä¸ªé¢†åŸŸçš„éƒ½æœ‰ï¼Œæ€ä¹ˆåŠï¼Ÿ

ä½ ä¼šé‡‡å–ä¸€ä¸ªé«˜æ•ˆçš„â€œ**æ³¨æ„åŠ›**â€ç­–ç•¥ï¼š
- å¸¦ç€é—®é¢˜æŸ¥è¯¢ï¼šä½ çš„è„‘å­é‡Œå¾ˆæ¸…æ¥šï¼Œä½ æƒ³è¦æ‰¾çš„æ˜¯â€œç¥ç»ç½‘ç»œâ€æ–¹é¢çš„æ•°æ®ï¼Œè¿™å°±æ˜¯ä½ çš„â€œæŸ¥è¯¢â€**ï¼ˆQueryï¼‰**
- å¿«é€Ÿæ‰«æä¹¦åï¼šä½ ä¼šæµè§ˆä¹¦æ¶ï¼Œå¾ˆæ£’çš„æ˜¯ï¼Œæ¯æœ¬ä¹¦éƒ½ä¼šæœ‰ä¹¦åï¼ˆ**é”® Key**ï¼‰ï¼Œä½ ä¸ç”¨è¯¦ç»†ç¿»å¼€å°±èƒ½çŸ¥é“æ˜¯å¦ç¬¦åˆä½ çš„æŸ¥è¯¢ã€‚ä¸€æœ¬ä¹¦çš„ä¹¦åå¦‚æœæ˜¯ã€Šæ·±åº¦å­¦ä¹ ç®€å²ã€‹ï¼Œå®ƒå°±ä¼šè·å¾—ä½ é«˜åº¦çš„å…³æ³¨ã€‚å¦‚æœä¹¦åæ˜¯ã€Šå›­è‰ºå…¥é—¨ã€‹ï¼Œä½ å°±ä¼šå¿½ç•¥å®ƒã€‚
- æ·±å…¥é˜…è¯»ï¼šå¯¹äºé‚£äº›ä½ è®¤ä¸ºé«˜åº¦ç›¸å…³çš„ä¹¦ç±ï¼Œä½ ä¼šæŠŠå®ƒä»¬æŠ½å‡ºæ¥ï¼Œ**ä»”ç»†é˜…è¯»å®ƒä»¬çš„å†…å®¹ï¼ˆå€¼ Valueï¼‰**ï¼Œå¹¶å°†è¿™äº›å†…å®¹ï¼Œå¸æ”¶åˆ°ä½ è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ä¸­ï¼Œä½ å¯èƒ½ä¸ä»…è¯»ä¸€æœ¬ï¼Œå¯èƒ½ä¼šé€‰æ‹©è¯»å¾ˆå¤šæœ¬ï¼Œå½¢æˆä½ è®ºæ–‡çš„æœ€ç»ˆè§‚ç‚¹ã€‚


æ³¨æ„åˆ°**Queryã€Keyã€Value**çš„æ„è±¡äº†å§ï¼æ­£æ˜¯Attentionæœºåˆ¶çš„çµé­‚ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å†å»ºç«‹**attentionçš„ç›´è§‰**ã€‚æˆ‘ä»¬æŠŠå¥å­é€è¿›attentionæœºåˆ¶çš„æ¨¡å‹ä¸­ï¼Œ
æ¯ä¸€ä¸ªè¯ï¼Œéƒ½ä¼šå½“ä¸€ä¸‹â€**é€›å›¾ä¹¦é¦†çš„å­¦ç”Ÿ**â€œã€‚

å‡è®¾æˆ‘ä»¬åªæœ‰ABCDå››ä¸ªè¯ï¼Œæœ‰è¶£çš„æ˜¯ï¼Œå½“Aå˜æˆå­¦ç”Ÿæ—¶ï¼Œ**BCDå°±ä¼šå˜æˆä¹¦**ï¼Œ**ç”šè‡³Aè‡ªå·±**ï¼Œä¹Ÿä¼šå˜æˆè‡ªå·±æŸ¥è¯¢çš„å¯¹è±¡ï¼Œå˜æˆä¸€æœ¬ä¹¦ï¼ˆç†è§£ä¸ºåœ¨å›¾ä¹¦é¦†è¸±æ­¥æ—¶ï¼Œæ€è€ƒè‡ªå·±è„‘è¢‹é‡Œåˆ°åº•æœ‰æ²¡æœ‰æƒ³è¦çš„çŸ¥è¯†ï¼‰ã€‚

åŒç†ï¼Œå½“Bå˜æˆå­¦ç”Ÿæ—¶ï¼ŒACDï¼Œä»¥åŠBéƒ½ä¼šå˜æˆä¹¦ã€‚

å›åˆ°Aå­¦ç”Ÿï¼Œä»¥Aè¯çš„è§†è§’ï¼Œä»–ä¼šå¸¦ç€è‡ªå·±çš„queryï¼ŒæŒ¨ä¸ªâ€œ**å®¡è§†**â€å…¶ä»–è¯

è€Œæ¯ä¸ªè¯ï¼Œéƒ½æœ‰ç€è‡ªå·±çš„**ä¹¦åkey**ï¼keyæµ“ç¼©äº†è¿™æœ¬ä¹¦çš„ç²¾åï¼Œæ‰€ä»¥å®¹æ˜“è®©queryæ¥ç²¾å‡†åˆ¤æ–­ã€‚

ç°åœ¨ï¼Œâ€**åŒ¹é…**â€œå¼€å§‹äº†ã€‚

å¦‚æœAæ˜¯â€œæ™ºèƒ½â€ï¼Œå®ƒçš„Queryå¯èƒ½å°±å¸¦ç€â€œå¯»æ‰¾æŠ€æœ¯ã€ç®—æ³•â€çš„æ„å›¾ã€‚å½“å®ƒé‡åˆ°Bï¼ˆâ€œäººå·¥â€ï¼‰æ—¶ï¼ŒBçš„Keyä¼šå¼ºçƒˆå›åº”ï¼šâ€œæˆ‘çš„ä¸»é¢˜æ˜¯â€˜æŠ€æœ¯â€™ï¼ä½ å¯ä»¥è¯¦ç»†çœ‹çœ‹æˆ‘â€ï¼›å½“å®ƒé‡åˆ°Cï¼ˆâ€œéå¸¸â€ï¼‰æ—¶ï¼ŒCçš„Keyå¯èƒ½åªä¼šå¾®å¼±å›åº”ï¼šâ€œæˆ‘æ˜¯â€˜ç¨‹åº¦å‰¯è¯â€™ï¼Œç¨ç¨æµè§ˆå³å¯â€œã€‚  

å½“keyçš„å¯¹åº”ç¨‹åº¦è¶Šé«˜ï¼ŒAè¯çœ‹è¿™æœ¬ä¹¦çš„å†…å®¹ï¼ˆå…¶valueï¼‰å°±ä¼šè¶Šè¯¦ç»†ã€‚

æœ€ç»ˆä¸€ä¸ªè¯çš„è¯å‘é‡ï¼Œå¯ä»¥ç†è§£ä¸º**ä¸‰ä¸ªé˜¶æ®µ**

1. queryå’Œkeyï¼ŒåŒå‘å¥”èµ´ï¼Œå…±åŒå†³å®šâ€**åŒ¹é…**â€œçš„ç¨‹åº¦
2. åŸºäºä¸Šä¸€æ­¥çš„ç¨‹åº¦ï¼Œæ·±å…¥è¯»å–æ¯ä¸€æœ¬ä¹¦çš„valueï¼ˆæ¯ä¸€æœ¬å“¦ï¼Œå°±ç®—"éå¸¸â€è¿™æœ¬ä¹¦å’Œæˆ‘ä»¬queryåŒ¹é…åº¦5%æˆ‘ä»¬ä¹Ÿè¯»ï¼Œå°±æ˜¯ç¨å¾®ç¿»ä¸€ä¸‹ä¸‹ã€‚
3. æŠŠæ‰€æœ‰é˜…è¯»åˆ°çš„ã€ç»è¿‡åŠ æƒå¤„ç†çš„ä¿¡æ¯**ç»¼åˆèµ·æ¥**ï¼Œå½¢æˆä¸€ä¸ªå…¨æ–°çš„ã€èåˆäº†å…¨å±€è§†é‡çš„â€œé˜…è¯»æŠ¥å‘Šâ€ï¼Œå³è¯å‘é‡ï¼

è€Œattentionæœºåˆ¶çš„å¦ä¸€ä¸ªä¼˜åŠ¿ï¼Œæ˜¯åˆšæ‰çš„æµç¨‹ï¼Œå¯¹æ¯ä¸ªè¯æ¥è¯´éƒ½æ˜¯åŒæ—¶çš„ã€‚**éƒ½æ˜¯åœ¨åŒä¸€ä¸ªè®¡ç®—æ­¥éª¤å†…ï¼Œå¹¶è¡Œå®Œæˆã€‚** 

>å¦‚æ­¤å»ºç«‹ç›´è§‰:
æ‰€æœ‰è¯å‘é‡è¿›å…¥è‡ªå·±çš„å¹³è¡Œå®‡å®™å›¾ä¹¦é¦†ï¼Œæ¯”å¦‚Açš„å›¾ä¹¦é¦†ä¸­ï¼ŒAæ˜¯æŸ¥è¯¢è€…ï¼ŒBCDéƒ½æ˜¯ä¹¦ï¼›
Bçš„å›¾ä¹¦é¦†ä¸­ï¼ŒBæ˜¯æŸ¥è¯¢è€…ï¼ŒACDéƒ½æ˜¯ä¹¦ã€‚ä»–ä»¬åœ¨å„è‡ªçš„å¹³è¡Œå®‡å®™é‡Œï¼ŒåŒæ—¶å¼€å§‹åœ¨å›¾ä¹¦é¦†æŸ¥è¯¢ï¼
è¿™å°±å®ç°äº†é€è¿›å»ä¸€ä¸ªå¥å­ï¼Œç«‹é©¬å‡ºæ¥å„ä¸ªè¯å‘é‡ç»„æˆçš„å¥å­å‘é‡ã€‚
## æµç¨‹è¯¦è§£

ç›´è§‰æ€§æˆ‘ä»¬å»ºç«‹å®Œæ¯•äº†ï¼Œé‚£ç¡¬æ ¸ä¸¥è°¨çš„åŸç†å‘¢ï¼Ÿ

### QKVçŸ©é˜µ
æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œåˆšæ‰è´¯ç©¿å§‹ç»ˆçš„queryã€keyã€valueï¼Œéƒ½æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ

åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œå¯¹äºå•ä¸ªè¯çš„è¿™ä¸‰ä¸ªå±æ€§ï¼Œæˆ‘ç®€ç§°ä¸ºqã€kã€vå‘é‡ã€‚

ä»¥Aè¯çš„è§†è§’ï¼Œä»–ä¸€è¿›å»attentionæ¨¡å‹ï¼Œæ¨¡å‹å°±ä¼šä¸º**æ¯ä¸€ä¸ªè¯å‘é‡**ï¼Œè¿›è¡Œä¸‰æ¬¡ç‹¬ç«‹çš„**çº¿æ€§å˜æ¢**ï¼ˆå³ä¹˜ä»¥ä¸‰ä¸ªä¸åŒçš„ã€å¯å­¦ä¹ çš„æƒé‡çŸ©é˜µÂ Wq,Â Wk,Â Wvï¼‰

ä¸‰ä¸ªçŸ©é˜µä¹˜å®Œåï¼Œå°±å˜æˆäº†qã€kã€vä¸‰ä¸ªå‘é‡ã€‚ **è¿™ç›¸å½“äºä¸ºæ¯ä¸ªè¯ï¼Œç¬é—´èµ‹äºˆäº†ä¸‰ä¸ªä¸åŒçš„â€œè§’è‰²â€æˆ–â€œèº«ä»½â€

æœ€å¼€å§‹çš„è¿™ä¸‰ä¸ªæƒé‡çŸ©é˜µï¼Œæ˜¯æˆ‘ä»¬åœ¨è®­ç»ƒä¸­ï¼Œä¸æ–­ä¿®æ”¹ï¼Œä¸æ–­æ‰“ç£¨ï¼ˆåå‘ä¼ æ’­ï¼‰ï¼Œæœ€ç»ˆæ¨¡å‹ä¼šé€æ¸å­¦ä¼šï¼Œå¦‚ä½•æœ€å¥½åœ°ä¸ºæ¯ä¸ªè¯æå–å‡ºqkvè¿™ä¸‰ç§ä¸åŒçš„ä¿¡æ¯ï¼Œä»¥å®Œæˆæœ€ç»ˆçš„ä»»åŠ¡ã€‚


æ¯”å¦‚åœ¨æ¼«é•¿çš„è®­ç»ƒåï¼Œæ¨¡å‹å¯èƒ½ä¼šå­¦åˆ°ï¼šâ€œå¯¹äºâ€œçŒ«â€è¿™ä¸ªè¯ï¼Œå®ƒçš„Queryåº”è¯¥å»å¯»æ‰¾â€œæŠšæ‘¸â€ã€â€œé“²å±å®˜â€ç­‰æ¦‚å¿µï¼›

å®ƒçš„Keyåº”è¯¥èƒ½æä¾›â€œå® ç‰©ã€æ¯›èŒ¸èŒ¸â€è¿™äº›æœ€å®¹æ˜“è¢«å…¶ä»–è¯ï¼ˆæ¯”å¦‚â€œå¯çˆ±â€ã€â€œæŠšæ‘¸â€ï¼‰æ‰¾åˆ°çš„ç‰¹å¾ã€‚

è€Œå®ƒçš„Valueåˆ™åŒ…å«æ›´ä¸°å¯Œã€æ›´æœ¬è´¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚â€œä¸€ç§å“ºä¹³åŠ¨ç‰©ã€æœ‰ä¹æ¡å‘½çš„ä¼ è¯´ã€ä¼šæ‰“å‘¼å™œâ€ã€‚

å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´è®­ç»ƒå‡ºäº†å¾ˆå¥½çš„è¯å‘é‡ã€‚

### æ³¨æ„åŠ›ç‚¹ç§¯
okï¼Œç°åœ¨æˆ‘ä»¬äººå·¥å®šä¹‰å¥½äº†qkvã€‚ é‚£ä¹ˆåœ¨å®é™…æ“ä½œä¸­ï¼Œåˆ°åº•æ€ä¹ˆå»æŠŠè¯å‘é‡è®¡ç®—å‡ºæ¥å‘¢ï¼Ÿ

æˆ‘ä»¬å†æ¬¡å¼•ç”¨ä¸€ä¸‹ä¸Šé¢è®²è¿‡çš„ç›´è§‰æµç¨‹

>æœ€ç»ˆä¸€ä¸ªè¯çš„è¯å‘é‡ï¼Œå¯ä»¥ç†è§£ä¸ºä¸‰ä¸ªé˜¶æ®µ
>1. queryå’Œkeyï¼ŒåŒå‘å¥”èµ´ï¼Œå…±åŒå†³å®šâ€åŒ¹é…â€œçš„ç¨‹åº¦

å…¶ä¸­ç¬¬ä¸€é˜¶æ®µï¼Œå¯¹åº”ä¸€ä¸ªå…³é”®çš„å…¬å¼ï¼Œå°±å«æ³¨æ„åŠ›ç‚¹ç§¯ã€‚

æˆ‘ä»¬é¦–å…ˆä»¥å•ä¸ªè¯çš„qå‘é‡çš„è§†è§’ã€‚ä»–è¦å»æŸ¥è¯¢ï¼Œå°±è¦ç§ç§æ‰€æœ‰çš„keyï¼Œå³keyå‘é‡ã€‚

æŸ¥è¯¢ï¼Œå…±åŒå†³å®šâ€åŒ¹é…â€œçš„ç¨‹åº¦è¿™ä¸€åŠ¨ä½œï¼Œåœ¨æ•°å­¦é‡Œï¼Œæ˜¯ç”¨â€**ç‚¹ç§¯**â€œå»ä»£æ›¿ã€‚

#### ç‚¹ç§¯
åœ¨å‡ ä½•è§’åº¦ï¼Œç‚¹ç§¯å…¬å¼`aÂ·b = |a||b|cos(Î¸)`ï¼Œèƒ½ä»£è¡¨å‘é‡åœ¨ç©ºé—´ä¸­æ–¹å‘æ˜¯å¦ç›¸ä¼¼ï¼Œé‚£ä¹ˆå½“ä¸€ä¸ªQueryå‘é‡å’Œä¸€ä¸ªKeyå‘é‡åœ¨è¯­ä¹‰ç©ºé—´ä¸­æŒ‡å‘ç›¸ä¼¼çš„æ–¹å‘æ—¶ï¼Œå®ƒä»¬çš„ç‚¹ç§¯å°±ä¼šå¾ˆå¤§ï¼Œä»£è¡¨ç€**é«˜åº¦åŒ¹é…**ã€‚å®Œç¾åœ°æ¨¡æ‹Ÿäº†â€œæŸ¥è¯¢â€è¿‡ç¨‹ã€‚

è®¡ç®—æœºæ˜¯å¦‚ä½•è®¡ç®—è¿™ä¸ªç‚¹ç§¯çš„å‘¢ï¼Ÿ

å®ƒé‡‡ç”¨äº†ä¸€ä¸ªç­‰ä»·çš„ä»£æ•°æ–¹æ³•ï¼šå°†ä¸¤ä¸ªå‘é‡åœ¨**æ¯ä¸€ä¸ªç»´åº¦**ä¸Šå¯¹åº”çš„å€¼ç›¸ä¹˜ï¼Œç„¶åå°†æ‰€æœ‰ç»“æœ**å…¨éƒ¨ç›¸åŠ **Â `(aÂ·b = a1*b1 + a2*b2 + ...)`

å¦‚æœqå‘é‡åœ¨ç¬¬5ä¸ªç»´åº¦ä¸Šæœ‰å¾ˆå¤§çš„å€¼ï¼Œkå‘é‡ä¹Ÿæ˜¯ï¼Œé‚£å®ƒä»¬åœ¨è¿™ä¸ªç»´åº¦ä¸Šçš„ä¹˜ç§¯ç»“æœå°±å¾ˆå¤§â€ï¼Œä»£è¡¨å®ƒä»¬åœ¨è¿™ä¸ªç‰¹å®šçš„â€œè¯­ä¹‰ç‰¹å¾â€ä¸Šäº§ç”Ÿäº†å¼ºçƒˆçš„å…±é¸£ã€‚

æœ€ç»ˆçš„æ±‚å’Œï¼Œåˆ™æ˜¯å°†æ‰€æœ‰ç»´åº¦çš„â€œå…±é¸£â€æ±‡æ€»æˆä¸€ä¸ªæ€»çš„åŒ¹é…åˆ†æ•°ã€‚

#### å¹¶è¡Œè®¡ç®—
ä¸¤ä¸ªè¯çš„qå’Œvï¼Œè¿›è¡Œç‚¹ç§¯ï¼Œå°±èƒ½è¡¨ç¤ºåŒ¹é…åº¦ã€‚

ä½†æˆ‘ä»¬æœ‰å¾ˆå¤šè¯å‘€ï¼Œæ¯æ¬¡éƒ½è¦åˆ†åˆ«è½®æµè®¡ç®—ç‚¹ç§¯å¤ªéº»çƒ¦äº†.

ä¸ºäº†å®ç°å¹¶è¡Œè®¡ç®—ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¯çš„qå‘é‡å †å æˆä¸€ä¸ª**QçŸ©é˜µ**ï¼Œæ‰€æœ‰kå‘é‡å †å æˆä¸€ä¸ª**KçŸ©é˜µ**ã€‚

ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡çŸ©é˜µä¹˜æ³•ï¼š

$$AttentionScores = Q @ K.T$$

**K.T**Â ä»£è¡¨å¯¹KçŸ©é˜µè¿›è¡Œ**è½¬ç½®**ã€‚

çŸ©é˜µä¹˜æ³•çš„è§„åˆ™ï¼Œèƒ½å¤Ÿå®Œç¾åœ°å®ç°â€œ**QçŸ©é˜µçš„æ¯ä¸€è¡Œï¼ˆæ¯ä¸ªè¯çš„qï¼‰**â€å»å’Œâ€œ**KçŸ©é˜µçš„æ¯ä¸€è¡Œï¼ˆæ¯ä¸ªè¯çš„kï¼‰**â€è¿›è¡Œç‚¹ç§¯ã€‚



![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1760000642376.jpeg)
							`å›¾:æ³¨æ„åŠ›ç‚¹ç§¯è¿‡ç¨‹ã€æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µ`

å‡è®¾æˆ‘ä»¬çš„å¥å­æ˜¯â€æˆ‘çˆ±äººå·¥æ™ºèƒ½â€œ 
- å¥å­ï¼šâ€œæˆ‘çˆ±äººå·¥æ™ºèƒ½â€ï¼ˆ6ä¸ªè¯ï¼‰
- hiddensizeï¼ˆæˆ‘ä»¬è‡ªå®šä¹‰çš„å‘é‡ç»´åº¦ï¼‰= 4
- **QçŸ©é˜µ**çš„å½¢çŠ¶æ˜¯Â `[6, 4]`Â (6ä¸ªè¯ï¼Œæ¯ä¸ªè¯çš„qæ˜¯4ç»´)ã€‚
- **KçŸ©é˜µ**çš„å½¢çŠ¶ä¹Ÿæ˜¯Â `[6, 4]`ã€‚
- **K.T**Â (Kçš„è½¬ç½®) çš„å½¢çŠ¶æ˜¯Â `[4, 6]`ã€‚
- Q @ K.TÂ çš„ç»“æœï¼Œå°±æ˜¯ä¸€ä¸ªÂ `[6, 6]`Â çš„**æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µ**ã€‚

æˆ‘ä»¬æ¥æ¬£èµä¸€ä¸‹è¿™ä¸ªæ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µï¼
- **ç¬¬1è¡Œ**ï¼Œä»£è¡¨â€œæˆ‘â€è¿™ä¸ªè¯ï¼Œä½œä¸ºæŸ¥è¯¢è€…ï¼Œå¯¹æ‰€æœ‰å…­ä¸ªè¯ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰çš„åŸå§‹å…³æ³¨åˆ†æ•°ã€‚
- **åæ ‡Â (1, 3)**Â çš„å€¼ï¼Œå°±æ˜¯â€œæˆ‘â€çš„qå‘é‡ä¸â€œäººâ€çš„kå‘é‡è¿›è¡Œç‚¹ç§¯çš„ç»“æœï¼Œä»£è¡¨â€œ**æˆ‘**â€å¯¹â€œäººâ€çš„åŒ¹é…åº¦ã€‚
- **åæ ‡Â (3, 4)**Â çš„å€¼ï¼Œå°±æ˜¯â€œäººâ€çš„qå‘é‡ä¸â€œå·¥â€çš„kå‘é‡è¿›è¡Œç‚¹ç§¯çš„ç»“æœï¼Œä»£è¡¨â€œ**äºº**â€å¯¹â€œå·¥â€çš„åŒ¹é…åº¦ã€‚

è‡³æ­¤ï¼Œç¬¬ä¸€é˜¶æ®µâ€”â€”â€œåŒ¹é…â€ï¼Œå·²ç»é€šè¿‡ä¸¥è°¨è€Œé«˜æ•ˆçš„çŸ©é˜µè¿ç®—å®Œæˆäº†ã€‚
æˆ‘ä»¬å¾—åˆ°äº†ä¸€å¼ è•´å«ç€å¥å­å†…éƒ¨æ‰€æœ‰è¯ä¸è¯ä¹‹é—´åŸå§‹å…³ç³»çš„å›¾ã€‚



### å¾—åˆ°ç»“æœ
å¥½ï¼Œç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªæ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µã€‚å®ç°äº†â€œqueryä¸keyçš„åŒ¹é…â€ã€‚

è¿˜è®°å¾—å—ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ªé˜¶æ®µ

>2. åŸºäºä¸Šä¸€æ­¥çš„ç¨‹åº¦ï¼Œæ·±å…¥è¯»å–æ¯ä¸€æœ¬ä¹¦çš„valueï¼ˆæ¯ä¸€æœ¬å“¦ï¼Œå°±ç®—"éå¸¸â€è¿™æœ¬ä¹¦å’Œæˆ‘ä»¬queryåŒ¹é…åº¦5%æˆ‘ä»¬ä¹Ÿè¯»ï¼Œå°±æ˜¯ç¨å¾®ç¿»ä¸€ä¸‹ä¸‹ã€‚)
>3. æŠŠæ‰€æœ‰é˜…è¯»åˆ°çš„ã€ç»è¿‡åŠ æƒå¤„ç†çš„ä¿¡æ¯**ç»¼åˆèµ·æ¥**ï¼Œå½¢æˆä¸€ä¸ªå…¨æ–°çš„ã€èåˆäº†å…¨å±€è§†é‡çš„â€œé˜…è¯»æŠ¥å‘Šâ€ï¼Œå³è¯å‘é‡ï¼

æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç¿»é˜…å†…å®¹ï¼

æˆ‘ä»¬å…ˆæŠŠè§†è§’æ”¾å°çœ‹ã€‚

æ¯”å¦‚ä¸Šè¿°æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µçš„ç¬¬ä¸€è¡Œï¼Œæ˜¯â€œæˆ‘â€è¿™ä¸ªè¯å¯¹æ•´ä¸ªå¥å­æ¯ä¸ªè¯çš„åŒ¹é…åˆ†æ•°ã€‚

ä½†è¿™é‡Œçš„æ•°å­—ï¼Œè¿˜åªæ˜¯**åŸå§‹çš„ã€æœªç»å¤„ç†çš„â€œåŒ¹é…åˆ†æ•°â€**ã€‚å®ƒä»¬çš„å¤§å°å¯èƒ½åƒå·®ä¸‡åˆ«ï¼Œä»æå¤§çš„æ­£æ•°åˆ°è´Ÿæ•°éƒ½æœ‰ã€‚


åœ¨å°†å®ƒä»¬ç”¨äºâ€œæŒ‡å¯¼é˜…è¯»â€ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åšä¸¤ä»¶é‡è¦çš„â€œé¢„å¤„ç†â€å·¥ä½œï¼š
- ç¼©æ”¾ï¼šè¿™æ˜¯ã€ŠAttention Is All You Needã€‹è®ºæ–‡ä¸­æå‡ºçš„ä¸€ä¸ªå…³é”®æŠ€å·§ã€‚ä¸ºäº†é˜²æ­¢ç‚¹ç§¯çš„ç»“æœè¿‡å¤§å¯¼è‡´è®­ç»ƒä¸ç¨³å®šï¼Œæˆ‘ä»¬ä¼šå°†æ•´ä¸ªåˆ†æ•°çŸ©é˜µé™¤ä»¥ä¸€ä¸ªç¼©æ”¾å› å­ï¼Œé€šå¸¸æ˜¯`sqrt(d_k)`ï¼ˆKeyå‘é‡ç»´åº¦çš„å¹³æ–¹æ ¹ï¼‰ã€‚å…¶ç›®çš„æ˜¯è®©æ•°å€¼æ›´ç¨³å®šï¼Œæœ‰åˆ©ç”¨æ¨¡å‹çš„è®­ç»ƒã€‚
- å½’ä¸€åŒ–ï¼šè¿˜è®°å¾—ï¼Œæˆ‘ä»¬æƒ³è¦ç”¨æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µè¡¨ç¤ºâ€œæ³¨æ„çš„ç¨‹åº¦â€ï¼Œé‚£ä¹ˆï¼Œ**æ¦‚ç‡**ä¸€å®šæ˜¯è¡¨è¾¾ç¨‹åº¦çš„æœ€å¥½é€‰æ‹©ã€‚æˆ‘ä»¬å°†è¿™äº›å¤§å°ä¸ä¸€çš„åˆ†æ•°ï¼Œè½¬æ¢æˆä¸€ä¸ª**æ€»å’Œä¸º1çš„ã€æ¼‚äº®çš„â€œæ¦‚ç‡åˆ†å¸ƒâ€**ã€‚è¿™å°±æ˜¯**Softmax**å‡½æ•°çš„ç”¨æ­¦ä¹‹åœ°ã€‚


> ç»è¿‡Softmaxå¤„ç†åï¼Œæˆ‘ä»¬â€œæˆ‘â€è¿™ä¸ªè¯å¯¹æ•´ä¸ªå¥å­çš„æ³¨æ„åŠ›åˆ†æ•°Â `[0.8, -0.1, 10.5, 9.2, 5.4, 3.1]`ï¼Œå°±ä¼šå˜æˆç±»ä¼¼Â `[0.01, 0.0, 0.4, 0.3, 0.2, 0.09]`Â è¿™æ ·çš„**æ³¨æ„åŠ›æƒé‡**ã€‚
> 
> è¿™äº›æƒé‡åŠ èµ·æ¥**ç­‰äº1**ï¼Œå®Œç¾åœ°æ¨¡æ‹Ÿäº†æˆ‘ä»¬â€œå›¾ä¹¦é¦†â€æ¯”å–»ä¸­çš„â€œ**æ³¨æ„åŠ›åˆ†é…**â€ï¼šæˆ‘å°†æŠŠ40%çš„æ³¨æ„åŠ›æ”¾åœ¨â€œäººâ€ä¸Šï¼Œ30%æ”¾åœ¨â€œå·¥â€ä¸Šï¼Œ20%æ”¾åœ¨â€œæ™ºâ€ä¸Š

æˆ‘ä»¬é€šè¿‡softmaxç¼©æ”¾ï¼Œå¾—åˆ°äº†**æ³¨æ„åŠ›æƒé‡**ï¼Œ

ä½†è¿™ä¸ªæƒé‡ï¼Œåªå†³å®šäº†æˆ‘å…³æ³¨çš„ç¨‹åº¦æ˜¯å¤šå°‘ï¼Œåˆ°åº•èƒ½å…³æ³¨ä»€ä¹ˆä¸œè¥¿ï¼Œè¿˜éœ€è¦ç»†ç»†ç¿»é˜…å‘¢ï¼

ä¸€ä¸ªè—æœ‰é»„é‡‘å±‹çš„ä¹¦ï¼Œå°±ç®—æˆ‘å…³æ³¨åº¦å¾ˆå°ï¼Œåˆ°æœ€åè·å–çš„ä¿¡æ¯ä»ç„¶ä¼šå¾ˆå¤šï¼›

ä¸€ä¸ªæœ‰å¾ˆå¤šåºŸè¯çš„ä¹¦ï¼Œå°±ç®—æˆ‘å‡­ç€ä¹¦åå…³æ³¨åº¦å¾ˆå¤§ï¼Œä»ç„¶ä¿¡æ¯ä¼šå¾ˆå°‘ã€‚

æ¯ä¸€ä¸ªè¯ï¼Œéƒ½æœ‰è‡ªå·±çš„valueå‘é‡ï¼Œæ­£æ˜¯â€è¿™æœ¬ä¹¦çš„å†…å®¹â€œã€‚

æˆ‘ä»¬è¦åšçš„ç¿»é˜…æ­¥éª¤ä¸ºï¼š

è¯å¯¹å¥å­çš„æ³¨æ„åŠ›ç¨‹åº¦å‘é‡ï¼Œä¸æ•´ä¸ªå¥å­çš„è¯çš„valueå‘é‡ï¼Œ

è¿›è¡Œâ€œ**åŠ æƒæ±‚å’Œ**â€


![](Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761186064791.jpeg)
			`å›¾ï¼šåŠ æƒæ±‚å’Œç¤ºæ„å›¾ã€‚æ³¨æ„åŠ›æƒé‡çŸ©é˜µä¸VçŸ©é˜µç›¸ä¹˜ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºçŸ©é˜µZã€‚`

æ•´ä¸ªåŠ æƒæ±‚å’ŒåŠ¨ä½œï¼Œä¸€ä¸ªçŸ©é˜µä¹˜æ³•å°±å…¨éƒ¨è§£å†³ã€‚

è®©æˆ‘ä»¬åƒçœ‹æ…¢åŠ¨ä½œä¸€æ ·ï¼Œè§£å‰–ä¸€ä¸‹çŸ©é˜µZä¸­çš„ç»“æœæ˜¯å¦‚ä½•è¯ç”Ÿçš„ï¼š

#### **å®è§‚è§†è§’ï¼šä¸€ä¸ªæ–°å‘é‡çš„è¯ç”Ÿ**

æˆ‘ä»¬æ¥çœ‹è¾“å‡ºçŸ©é˜µZçš„**ç¬¬ä¸€æ•´è¡Œ**ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨â€œæˆ‘â€çš„**æ–°è¯å‘é‡ `zâ‚`**ã€‚è¿™ä¸ªå‘é‡ï¼Œæ˜¯ç”±â€œæ³¨æ„åŠ›æƒé‡çŸ©é˜µâ€çš„**ç¬¬ä¸€è¡Œ**ï¼ˆâ€œæˆ‘â€å¯¹æ‰€æœ‰è¯çš„å…³æ³¨åº¦ï¼‰ä¸**æ•´ä¸ªVçŸ©é˜µ**ï¼ˆæ‰€æœ‰è¯çš„â€œå†…å®¹â€ï¼‰å…±åŒå†³å®šçš„ã€‚

å…¶è®¡ç®—å…¬å¼ï¼Œæ­£æ˜¯ä¸€ä¸ª**åŠ æƒæ±‚å’Œ**ï¼š

$z_1 = (s_{11} \cdot v_1) + (s_{12} \cdot v_2) + (s_{13} \cdot v_3) + (s_{14} \cdot v_4) + (s_{15} \cdot v_5) + (s_{16} \cdot v_6)$

*   å…¶ä¸­ï¼Œ`zâ‚` å’Œ `vâ‚...vâ‚†` éƒ½æ˜¯**å‘é‡**ï¼ˆ4ç»´ï¼‰ã€‚
*   `sâ‚â‚...sâ‚â‚†` åˆ™æ˜¯**æ ‡é‡**ï¼ˆå•ä¸€çš„æƒé‡æ•°å­—ï¼‰ã€‚

è¿™ä¸ªå…¬å¼å‘Šè¯‰æˆ‘ä»¬ï¼Œæ–°çš„â€œæˆ‘â€å‘é‡ `zâ‚`ï¼Œæ˜¯ç»è¿‡å¤šä¸ªvalueå¾—å‡ºçš„ï¼šå®ƒåŒ…å«äº†`sâ‚â‚`æ¯”ä¾‹çš„`vâ‚`ï¼ˆâ€œæˆ‘â€è‡ªå·±çš„å†…å®¹ï¼‰ï¼Œ`sâ‚â‚‚`æ¯”ä¾‹çš„`vâ‚‚`ï¼ˆâ€œçˆ±â€çš„å†…å®¹ï¼‰ï¼Œ`sâ‚â‚ƒ`æ¯”ä¾‹çš„`vâ‚ƒ`ï¼ˆâ€œäººâ€çš„å†…å®¹ï¼‰...ç­‰ç­‰ã€‚


è¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Ÿé‚£æˆ‘ä»¬å†æŠŠè§†è§’æ”¾å°ã€‚

#### **å¾®è§‚è§†è§’ï¼šä¸€ä¸ªæ–°å…ƒç´ çš„è®¡ç®—**

æ–°å‘é‡ `zâ‚` å†…éƒ¨çš„**æ¯ä¸€ä¸ªå…·ä½“æ•°å­—**ï¼Œåˆæ˜¯å¦‚ä½•ç®—å‡ºæ¥çš„å‘¢ï¼Ÿ

è®©æˆ‘ä»¬èšç„¦äºå®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´  `zâ‚â‚`ã€‚

è¿™ä¸ªæ•°å­—ï¼Œä»£è¡¨äº†æ–°çš„â€œæˆ‘â€å‘é‡ï¼Œåœ¨å…¶â€œ**ç¬¬ä¸€ä¸ªè¯­ä¹‰ç»´åº¦**â€ä¸Šçš„æœ€ç»ˆå€¼ã€‚å®ƒçš„è¯ç”Ÿï¼Œä¹Ÿéµå¾ªç€â€œåŠ æƒæ±‚å’Œâ€çš„é€»è¾‘ï¼š

**å®ƒæ˜¯å¯¹æ‰€æœ‰Valueå‘é‡çš„â€œç¬¬ä¸€ä¸ªè¯­ä¹‰ç»´åº¦â€çš„å€¼ï¼Œè¿›è¡Œçš„ä¸€æ¬¡åŠ æƒ**

$z_{11} = (s_{11} \cdot v_{11}) + (s_{12} \cdot v_{21}) + (s_{13} \cdot v_{31}) + (s_{14} \cdot v_{41}) + (s_{15} \cdot v_{51}) + (s_{16} \cdot v_{61})$

*   `zâ‚â‚` æ˜¯æ–°å‘é‡çš„**ç¬¬ä¸€ä¸ªç»´åº¦**çš„å€¼ã€‚
*   `vâ‚â‚, vâ‚‚â‚, vâ‚ƒâ‚...` åˆ†åˆ«æ˜¯VçŸ©é˜µ**ç¬¬ä¸€åˆ—**çš„æ‰€æœ‰å€¼ï¼Œå®ƒä»¬å¯ä»¥è¢«ç†è§£ä¸ºæ‰€æœ‰è¯çš„Valueå‘é‡åœ¨â€œ**ç¬¬1ä¸ªè¯­ä¹‰ç»´åº¦**â€ä¸Šçš„åˆ†é‡ã€‚


**æ¢å¥è¯è¯´ï¼š**
- è¦è®¡ç®—æ–°å‘é‡çš„**ç¬¬1ä¸ªç»´åº¦**ï¼Œæˆ‘ä»¬å°±ç”¨æ³¨æ„åŠ›æƒé‡ï¼Œå»â€œåŠ æƒæ±‚å’Œâ€æ‰€æœ‰æ—§å‘é‡çš„**ç¬¬1ä¸ªç»´åº¦**ã€‚
- åŒç†ï¼Œè¦è®¡ç®—æ–°å‘é‡çš„**ç¬¬2ä¸ªç»´åº¦ (zâ‚â‚‚)**ï¼Œæˆ‘ä»¬å°±ç”¨**åŒä¸€å¥—**æ³¨æ„åŠ›æƒé‡ï¼Œå»â€œåŠ æƒæ±‚å’Œâ€æ‰€æœ‰æ—§å‘é‡çš„**ç¬¬2ä¸ªç»´åº¦**ã€‚
- ...ä»¥æ­¤ç±»æ¨ã€‚

å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨æ•°å­¦å½¢å¼ä¸Šï¼Œä¸æˆ‘ä»¬ä¹‹å‰ä¸ºè®¡ç®—â€œæ³¨æ„åŠ›åˆ†æ•°â€è€Œä½¿ç”¨çš„â€œç‚¹ç§¯â€éå¸¸ç›¸ä¼¼ã€‚

ä½†å®ƒä»¬çš„â€œè¯­ä¹‰â€æˆªç„¶ä¸åŒï¼š

>å¯¹æ¯”ä¸€ä¸‹ç‚¹ç§¯å’ŒåŠ æƒæ±‚å’Œ
- **ç‚¹ç§¯**çš„ç›®çš„æ˜¯**è¡¡é‡ç›¸ä¼¼åº¦**ï¼Œè¾“å…¥æ˜¯ä¸¤ä¸ªå‘é‡ï¼Œäº§å‡ºçš„æ˜¯ä¸€ä¸ª**æ ‡é‡ï¼ˆå•ä¸€æ•°å­—ï¼‰**ã€‚æˆ‘ä»¬åœ¨â€œQKåŒ¹é…â€é˜¶æ®µç”¨è¿‡å®ƒäº†ï¼Œæ˜¯ä¸ºäº†â€œæ¯”è¾ƒâ€ä¸€ä¸ªQueryå‘é‡å’Œä¸€ä¸ªKeyå‘é‡çš„æ‰€æœ‰ç»´åº¦
- **åŠ æƒæ±‚å’Œ**çš„ç›®çš„æ˜¯**èåˆä¿¡æ¯**ï¼Œè¾“å…¥æ˜¯ä¸€ç»„æ ‡é‡å’Œä¸€ä¸ªå‘é‡ï¼Œäº§å‡ºçš„æ˜¯ä¸€ä¸ª**æ–°çš„å‘é‡**ã€‚å®ƒçš„é€»è¾‘æ˜¯ï¼šâ€œå–Açš„70%ï¼ŒåŠ ä¸ŠBçš„20%ï¼Œå†åŠ ä¸ŠCçš„10%ï¼Œæ··åˆæˆä¸€ä¸ªæ–°çš„ä¸œè¥¿â€ã€‚æ˜¯ä¸ºäº†â€œèåˆâ€æ¥è‡ªä¸åŒValueå‘é‡çš„åŒä¸€ä¸ªç»´åº¦çš„ä¿¡æ¯


ä¸Šè¿°æ— è®ºæ˜¯å®è§‚è§†è§’è¿˜æ˜¯å¾®è§‚è§†è§’ï¼Œæˆ‘ä»¬éƒ½ç”¨ä¸€ä¸ªå…¬å¼å°±èƒ½å®Œå…¨è¡¨è¾¾ï¼š

$$Z = AttentionWeights @ V$$

- Attention_Weightsï¼šæ˜¯æˆ‘ä»¬ç»è¿‡Softmaxå¤„ç†åçš„`Â [6, 6]`Â æƒé‡çŸ©é˜µã€‚
- Vï¼šæ˜¯æ‰€æœ‰è¯çš„Valueå‘é‡å †å æˆçš„`Â [6, 4]`Â çš„VçŸ©é˜µã€‚
- Zï¼šå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ã€å…¨æ–°çš„Â `[6, 4]`Â **è¾“å‡ºçŸ©é˜µ**


# Self-attentionå’Œcross-attention

æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œç›®å‰è®²çš„QKVï¼Œéƒ½äº§ç”Ÿå“ªä¸ªç¾¤ä½“ï¼Ÿ

æ­£æ˜¯é€è¿›å»çš„é‚£ä¸€æ‰¹åºåˆ—ã€‚ æ¯”å¦‚â€œæˆ‘çˆ±äººå·¥æ™ºèƒ½â€ï¼Œ è¿™ä¸€æ‰¹æœ‰å…­ä¸ªè¯ï¼Œè¿™å…­ä¸ªè¯éƒ½åˆ†åˆ«å½“ä¸€æ¬¡â€œæŸ¥é˜…å›¾ä¹¦é¦†çš„äººâ€ã€å…­æ¬¡â€œè¢«æŸ¥é˜…çš„ä¹¦â€ã€‚  

æˆ‘ä»¬ç§°QKVåŒæºã€‚ ä»–ä»¬ç¡®å®éƒ½å±äºåŒä¸€ä¸ªç¾¤ä½“ã€‚ 

æ‰€ä»¥è¿™é‡Œçš„â€œselfâ€ æ˜¯æŠŠâ€œä¸€ä¸ªå®Œæ•´å¥å­â€å½“ä½œselfä¸»ä½“ã€‚

æ€è€ƒä¸€ä¸‹ï¼Œè¿™æ ·åšæœ‰ä»€ä¹ˆæ•ˆæœï¼Ÿ

æ¯ä¸€ä¸ªè¯å‘é‡ï¼Œéƒ½æ˜¯é˜…è¯»æ•´ä¸ªå¥å­ï¼Œå…³æ³¨ä»–çš„å…„å¼Ÿï¼ˆä¸Šä¸‹æ–‡ï¼‰ ï¼Œæœ€ç»ˆäº§å‡ºçš„ç»“æœã€‚

æ‰€ä»¥**Self-Attentionçš„æ ¸å¿ƒä½¿å‘½ï¼Œå°±æ˜¯æ·±åº¦æŒ–æ˜ä¸€ä¸ªåºåˆ—å†…éƒ¨çš„ä¾èµ–å…³ç³»ï¼Œé‡å¡‘æ¯ä¸€ä¸ªè¯çš„å‘é‡ï¼Œä½¿å…¶æœ€ç²¾å‡†åœ°è•´å«å½“å‰è¯­å¢ƒä¸‹çš„å«ä¹‰.**

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ€è€ƒä¸€ä¸ªæ›´å¤æ‚çš„åœºæ™¯ ï¼š

Aå¥æ˜¯è‡ªç„¶è¯­è¨€è½¬åŒ–çš„æ–‡æœ¬åºåˆ—å‘é‡ï¼ˆä¸Šä¸ªæ–‡ç« è®²è¿‡çš„ï¼‰ï¼Œæ¯”å¦‚â€œå°çŒ«èºº
ã€æ²™å‘â€ï¼Œä»–æœ‰è‡ªå·±çš„QKVçŸ©é˜µã€‚

Bå¥ï¼Œæ˜¯å°†â€œå°çŒ«èººæ²™å‘â€çš„å›¾ç‰‡åºåˆ—å‘é‡ï¼Œé€šè¿‡æŸç§æ–¹å¼ï¼Œå˜æˆå‘é‡ã€‚ ä¹Ÿæœ‰QKVçŸ©é˜µã€‚

æˆ‘ä»¬å¸Œæœ›è¿™ä¸¤ä¸ªåºåˆ—èƒ½å¤Ÿâ€œå¯¹è¯â€ï¼Œäº’ç›¸ç†è§£ã€‚è¿™å°±éœ€è¦Attentionæœºåˆ¶å¦ä¸€åº”ç”¨â€”â€”**äº¤å‰æ³¨æ„åŠ›ï¼ˆCross-Attentionï¼‰**ã€‚

æˆ‘ä»¬æ‹¿Aå¥çš„Qï¼Œå»å’ŒBå¥çš„KåŒ¹é…ï¼Œæœ€åå°†å…³æ³¨ç¨‹åº¦åº”ç”¨åˆ°â€œVçŸ©é˜µâ€é‡Œï¼Œ
å¦‚æ­¤æœ€ç»ˆäº§ç”Ÿçš„å‘é‡ï¼Œæœ‰ä»€ä¹ˆæ•ˆæœï¼Ÿ

å¯¹äº¤å‰æ³¨æ„åŠ›ï¼Œæˆ‘ä»¬å¦‚æ­¤åˆ†æï¼š
- **è°æ˜¯æŸ¥è¯¢è€… (Query)ï¼Ÿ**Â æ–‡æœ¬Aã€‚å› ä¸ºå®ƒæƒ³ä¸»åŠ¨å»è·å–å›¾ç‰‡çš„ä¿¡æ¯ã€‚
- **è°æ˜¯ä¿¡æ¯æº (Key, Value)ï¼Ÿ**Â å›¾ç‰‡Bã€‚å®ƒè¢«åŠ¨åœ°æä¾›ä¿¡æ¯ä»¥ä¾›æŸ¥è¯¢ã€‚
- **æµç¨‹ï¼š**Â æˆ‘ä»¬æ‹¿å‡ºæ–‡æœ¬Açš„**QçŸ©é˜µ**ï¼Œå»å’Œå›¾ç‰‡Bçš„**KçŸ©é˜µ**è¿›è¡ŒåŒ¹é…($Q_A @ K_{B}.T$)ï¼Œç„¶åç”¨å¾—åˆ°çš„æƒé‡ï¼Œå»åŠ æƒæ±‚å’Œå›¾ç‰‡Bçš„**VçŸ©é˜µ**ã€‚
- **ç»“æœï¼š**Â æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ–°çš„**æ–‡æœ¬åºåˆ—å‘é‡**ã€‚è¿™ä¸ªæ–°å‘é‡çš„å‰å®³ä¹‹å¤„åœ¨äºï¼Œå®ƒçš„æ¯ä¸€ä¸ªè¯ï¼ˆæ¯”å¦‚â€œå°çŒ«â€ï¼‰ï¼Œéƒ½å·²ç»å¸æ”¶äº†å›¾ç‰‡ä¸­æœ€åƒâ€œ**å°çŒ«**â€çš„é‚£ä¸ªåŒºåŸŸçš„è§†è§‰ç‰¹å¾ã€‚æ–‡å­—ï¼Œè¢«æ³¨å…¥äº†è§†è§‰çš„çµé­‚


é‚£å¦‚æœQ å’ŒKVæ¢ä¸€ä¸‹å‘¢ï¼Ÿ

- **è°æ˜¯æŸ¥è¯¢è€… (Query)ï¼Ÿ**Â å›¾ç‰‡Bã€‚
- **è°æ˜¯ä¿¡æ¯æº (Key, Value)ï¼Ÿ**Â æ–‡æœ¬Aã€‚
- **æµç¨‹ï¼š**Â æˆ‘ä»¬æ‹¿å‡ºå›¾ç‰‡Bçš„**QçŸ©é˜µ**ï¼Œå»å’Œæ–‡æœ¬Açš„**KçŸ©é˜µ**è¿›è¡ŒåŒ¹é…(Q_B @ K_A.T)ï¼Œç„¶ååŠ æƒæ±‚å’Œæ–‡æœ¬Açš„**VçŸ©é˜µ**ã€‚
- **ç»“æœï¼š**Â æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ–°çš„**å›¾åƒåºåˆ—å‘é‡**ã€‚ç°åœ¨ï¼Œå›¾ç‰‡ä¸­â€œçŒ«â€çš„é‚£ä¸ªåŒºåŸŸï¼Œè¢«æ³¨å…¥äº†â€œå°çŒ«â€è¿™ä¸ªè¯çš„è¯­ä¹‰ï¼›â€œæ²™å‘â€çš„åŒºåŸŸï¼Œè¢«æ³¨å…¥äº†â€œæ²™å‘â€çš„è¯­ä¹‰ã€‚å›¾ç‰‡ï¼Œè¢«è´´ä¸Šäº†ç²¾å‡†çš„è¯­ä¹‰æ ‡ç­¾ã€‚

![](../../../assets1/image/ä»â€œå›¾ä¹¦é¦†â€åˆ°â€œå¹³è¡Œå®‡å®™â€ï¼šä¸€æ¬¡å¯¹Attentionæœºåˆ¶çš„æ·±åº¦è§£å‰–-1761394025383.jpeg)

**ç»“è®ºï¼š**
- **Self-Attention**Â æ˜¯Â Q(A), K(A), V(A)ï¼Œç”¨äº**ç†è§£è‡ªèº«**ã€‚
- **Cross-Attention**Â æ˜¯Â Q(A), K(B), V(B)ï¼Œç”¨äº**Aç†è§£B**ã€‚

Cross-attentionæ˜¯Transformeræ¨¡å‹ä¸­ï¼Œå¤„ç†ä¸åŒæ¨¡æ€ï¼ˆæ–‡ã€å›¾ã€å£°ï¼‰æˆ–ä¸åŒä»»åŠ¡ï¼ˆç¿»è¯‘çš„æºå¥å’Œç›®æ ‡å¥ï¼‰ä¹‹é—´ä¿¡æ¯äº¤äº’çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚


# Multi-Head Attention
ç›®å‰ä¸ºä¹‹ï¼Œattentionâ€œæ³¨æ„â€çš„è¿™ä¸ªæ¦‚å¿µï¼Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜
- è‡ªæˆ‘ä¸­å¿ƒï¼šattentionæœºåˆ¶æ˜¾ç„¶ä¼šè¿‡åº¦å…³æ³¨è‡ªå·±ï¼Œä½“ç°åœ¨æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µä¸Šï¼Œå°±æ˜¯å¯¹è§’çº¿å…ƒç´ è¿‡å¤§ã€‚
- è§†è§’å•ä¸€ï¼šç”±äºå¯¹æ¯ä¸ªè¯ï¼Œqã€kå‘é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆâ€œåŒ¹é…â€é˜¶æ®µåªèƒ½æœ‰ä¸€ä¸ªéƒ¨åˆ†ã€‚å›åˆ°å›¾ä¹¦é¦†çœ‹ä¹¦çš„ç›´è§‰ï¼Œå°±æ˜¯å°±æ˜¯ä¹¦åå¯èƒ½å¾ˆé•¿ï¼Œä½†æˆ‘ä»¬åªæ³¨æ„äº†ä¸€ä¸ªå…³é”®å­—
	 - è¿™é‡Œæˆ‘æƒ³åˆ°ä¸€ä¸ªå¾ˆå¥½ç©çš„åœºæ™¯ï¼š æˆ‘ä»¬çš„queryæ˜¯å­¦ä¹ å¦‚ä½•çƒ¹é¥ªç¾é£Ÿï¼Œä¹¦åkeyæ˜¯â€åˆ›é€ å‡ºé¡¶çº§ç¾é£Ÿçš„å¨æˆ¿æ¸…ç†æ•™ç¨‹â€œï¼Œæˆ‘ä»¬å…³æ³¨åˆ°ç¾é£Ÿï¼Œä»¥ä¸ºå¾ˆåŒ¹é…ï¼Œç»“æœï¼Œä½ å…´å†²å†²åœ°æŠŠä¹¦çš„â€œå†…å®¹â€ï¼ˆValueï¼‰æ‹¿è¿‡æ¥ä¸€çœ‹ï¼Œå‘ç°é‡Œé¢å…¨æ˜¯å…³äºå¦‚ä½•æ“¦æ´—æ²¹æ±¡å’Œæ”¶çº³å¨å…·çš„æŠ€å·§ã€‚**è¿™å°±æ˜¯å•ä¸€è§†è§’çš„é™·é˜±ï¼šå®ƒå¯èƒ½ä¼šè¢«ä¸€ä¸ªå±€éƒ¨çš„ã€å¼ºçƒˆçš„ä¿¡å·æ‰€â€œæ¬ºéª—â€ï¼Œè€Œå¿½ç•¥äº†æ•´ä½“çš„ã€æ›´çœŸå®çš„æ„å›¾ã€‚**
- ä¸äººç±»æ³¨æ„åŠ›çš„å·®è·ï¼šçœ‹åˆ°ä¸€åªçŒ«ï¼Œæˆ‘ä»¬å¯èƒ½åŒæ—¶å…³æ³¨å®ƒçš„â€œé¢œè‰²â€ã€â€œå§¿æ€â€ã€â€œå“ç§â€ï¼Œç”šè‡³å®ƒå’Œâ€œæ²™å‘â€çš„ç›¸å¯¹ä½ç½®ã€‚è®©ä¸€ä¸ªAttentionâ€œç ”ç©¶å‘˜â€åŒæ—¶æŒæ¡æ‰€æœ‰è¿™äº›åˆ†æè§†è§’ï¼Œå¤ªéš¾äº†

é‚£ä¹ˆå›åˆ°attentionæœºåˆ¶æ¥è¯´ï¼Œå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å’Œæ¨¡ä»¿äººç±»è§†è§’å‘¢ï¼Ÿ

æˆ‘ä»¬å°†åŸå§‹QKVçŸ©é˜µï¼Œé€šè¿‡**å¤šç»„ï¼ˆæ¯”å¦‚8ç»„ï¼‰ç‹¬ç«‹**çš„çº¿æ€§å±‚ï¼Œ**åˆ†åˆ«æŠ•å½±**åˆ°8ä¸ªä¸åŒçš„ã€æ›´ä½ç»´åº¦çš„â€œ**è¯­ä¹‰å­ç©ºé—´**â€ä¸­ï¼Œå¾—åˆ°Â (qâ‚,kâ‚,vâ‚), (qâ‚‚,kâ‚‚,vâ‚‚), ..., (qâ‚ˆ,kâ‚ˆ,vâ‚ˆ)

åœ¨ç›´è§‰ä¸Šå¯ä»¥ç†è§£ä¸ºï¼Œåœ¨å›¾ä¹¦é¦†æŸ¥é˜…çš„åŒå­¦ï¼Œä½¿ç”¨äº†åˆ†èº«æœ¯ï¼Œå„è‡ªåˆ†å·¥ï¼Œè¿›è¡ŒåŸæ¥ä¹¦åº“çš„æŸ¥é˜…ä¸ç†è§£ã€‚ ä¸”åˆ†èº«æœ¯åŒæ ·åˆ†èµ°äº†å¤§è„‘çš„èµ„æºï¼

åˆ†å‡ºæ¥çš„æ¯ä¸€å¥—qkvï¼Œæˆ‘ä»¬éƒ½å«ä¸€ä¸ªattention headã€‚

æ¯ä¸€ä¸ªâ€å¤´â€œéƒ½æ˜¯ç‹¬ç«‹ã€å¹¶è¡Œåœ°æ‰§è¡Œå‰é¢æˆ‘ä»¬å­¦è¿‡çš„å®Œæ•´çš„attentionæµç¨‹çš„ã€‚

ç»è¿‡è®­ç»ƒï¼Œè¿™äº›ä¸åŒçš„â€œå¤´â€ä¼š**è‡ªå‘åœ°å­¦ä¼šåˆ†å·¥**ï¼Œä»ä¸åŒçš„è§’åº¦å»åˆ†æä¿¡æ¯ï¼š

- **Head 1**Â å¯èƒ½å˜æˆäº†**å¥æ³•ä¸“å®¶**
- **Head 2**Â å¯èƒ½å˜æˆäº†**è¯­ä¹‰ä¸“å®¶**ã€‚
- **Head 3**Â å¯èƒ½å˜æˆäº†**ä½ç½®å…³ç³»ä¸“å®¶

**æœ€ç»ˆï¼Œâ€åˆ†èº«â€ä»¬è¿›è¡Œä¸€æ¬¡åˆä½“:**
- æ‰€æœ‰8ä¸ªä¸“å®¶ç»„éƒ½æäº¤äº†æŠ¥å‘ŠÂ zâ‚, zâ‚‚, ..., zâ‚ˆã€‚
- æ¨¡å‹å°†è¿™8ä»½æŠ¥å‘Šæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä»½åŒ…å«äº†æ‰€æœ‰ä¸“å®¶æ„è§çš„ã€ä¿¡æ¯é‡æå¤§çš„â€œç»¼åˆæŠ¥å‘Šâ€ã€‚
- æœ€åï¼Œé€šè¿‡**å¦ä¸€ä¸ª**çº¿æ€§å±‚ï¼Œå¯¹è¿™ä»½â€œç»¼åˆæŠ¥å‘Šâ€è¿›è¡Œæœ€ç»ˆçš„æç‚¼å’Œæ•´åˆï¼Œå¾—åˆ°Multi-Head Attentionçš„æœ€ç»ˆè¾“å‡ºã€‚


![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761188799238.jpeg)
							`å›¾ï¼šå¤šå¤´æ³¨æ„åŠ›è¯¦è§£`
å¦‚å›¾ï¼Œåœ¨ä»£ç ä¸­ï¼ŒåŸå§‹çš„è¾“å…¥å‘é‡ï¼Œé¦–å…ˆè¿˜æ˜¯åƒä¹‹å‰ä¸€æ ·ï¼Œç»è¿‡**ä¸‰ç»„å¤§çš„çº¿æ€§å˜æ¢**ï¼Œå¾—åˆ°å®è§‚çš„Q, K, Vã€‚

ä½†æ¥ä¸‹æ¥ï¼Œè¿™ä¸‰ä¸ªå¤§çš„Q, K, VçŸ©é˜µï¼Œä¼šè¢«**ç›´æ¥ã€é«˜æ•ˆåœ°**åœ¨â€œç»´åº¦â€è¿™ä¸ªè½´ä¸Šï¼Œ**åˆ‡åˆ†**æˆ8ä¸ªæ›´å°çš„qâ‚,kâ‚,vâ‚,Â qâ‚‚,kâ‚‚,vâ‚‚...ã€‚æ¯”å¦‚å¤§QçŸ©é˜µæ˜¯516ç»´ï¼Œé‚£ä¹ˆHead1çš„q1å°±æ˜¯516/8 ç»´ã€‚

æ¯ä¸€ä¸ªheadï¼Œéƒ½ä¼šç”¨è‡ªå·±çš„QKVåšæ³¨æ„åŠ›ç‚¹ç§¯ï¼ˆScaled D-P Attention)ã€‚

ç„¶åï¼Œå¾—åˆ°å„è‡ªçš„è¾“å‡ºzâ‚, zâ‚‚...

æˆ‘ä»¬å°†çŸ©é˜µè¿›è¡Œæ‹¼æ¥ï¼Œæ‹¼æ¥æˆç»å…¸æµç¨‹ä¸­è¾“å‡ºçš„çŸ©é˜µç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„ï¼‰ã€‚

æ¥ç€æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ä¸ª**çº¿æ€§å±‚**linearï¼ç”¨æ¥â€œæ•´åˆâ€è¿™8ä¸ªè§†è§’çš„ä¿¡æ¯ã€‚è¾“å‡ºç»´åº¦ä¸å˜ã€‚å¾—åˆ°æœ€ç»ˆçš„Multi-Head Outputã€‚



æˆ‘ä»¬å›åˆ°â€œç¾é£Ÿæ¸…ç†æ•™ç¨‹â€çš„ä¾‹å­çœ‹çœ‹ï¼Œè¿‡ä¸€éå®Œæˆçš„multihead-attentionã€‚

å½“è¿™ä¸ªä¹¦åï¼ˆKeyï¼‰è¿›å…¥æ¨¡å‹æ—¶ï¼Œ8ä¸ªâ€œå¤´â€ä¼šä»8ä¸ªä¸åŒçš„â€œå­ç©ºé—´â€å»å®¡è§†å®ƒï¼š

- **Head 1 (ç¾é£Ÿå®¶å¤´):**Â å®ƒå¯èƒ½è¢«è®­ç»ƒå¾—å¯¹â€œç¾é£Ÿâ€ã€â€œçƒ¹é¥ªâ€è¿™ç±»è¯é«˜åº¦æ•æ„Ÿï¼Œå®ƒä¼šç»™å‡ºä¸€ä¸ª**é«˜åˆ†**ã€‚
- **Head 2 (æ¸…æ´å·¥å¤´):**Â å®ƒå¯èƒ½å¯¹â€œæ¸…ç†â€ã€â€œæ•™ç¨‹â€ã€â€œæ‰“æ‰«â€é«˜åº¦æ•æ„Ÿï¼Œå®ƒä¹Ÿä¼šç»™å‡ºä¸€ä¸ª**é«˜åˆ†*
- **Head 3 (åŠ¨è¯ä¸“å®¶å¤´):**Â å®ƒå¯èƒ½ä¸“æ³¨äºæ ¸å¿ƒåŠ¨è¯ï¼Œå‘ç°â€œåˆ›é€ â€å’Œâ€œæ¸…ç†â€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ„å›¾ã€‚
- **Head 4, 5, 6...**Â å¯èƒ½ä¼šå…³æ³¨è¯­æ³•ã€è¯è¯­æ­é…ç­‰å…¶ä»–æ–¹é¢ã€‚

åœ¨æœ€ç»ˆçš„æ•´åˆé˜¶æ®µï¼Œæ¨¡å‹ä¼šçœ‹åˆ°ï¼Œè™½ç„¶â€œç¾é£Ÿå®¶å¤´â€å¾ˆå…´å¥‹ï¼Œä½†åŒæ ·å…´å¥‹çš„è¿˜æœ‰â€œæ¸…æ´å·¥å¤´â€ã€‚

é€šè¿‡å­¦ä¹ ï¼Œæ¨¡å‹ä¼šæ˜ç™½ï¼Œå½“è¿™ä¸¤ä¸ªâ€œå¤´â€**åŒæ—¶**è¢«æ¿€æ´»æ—¶ï¼Œè¿™å¥è¯çš„çœŸå®æ„å›¾ï¼Œå¾ˆå¯èƒ½ä¸â€œå®¶åŠ¡â€ç›¸å…³ï¼Œè€Œä¸æ˜¯â€œçƒ¹é¥ªâ€ã€‚

äºæ˜¯ï¼Œå®ƒå°±èƒ½å¤Ÿåšå‡ºæ›´ç²¾å‡†çš„åˆ¤æ–­ï¼Œé™ä½å¯¹è¿™æœ¬ä¹¦çš„æ•´ä½“æ³¨æ„åŠ›ã€‚

æ‰€ä»¥ï¼ŒMulti-Head Attentioné€šè¿‡â€œåˆ†è€Œæ²»ä¹‹â€å’Œâ€œé›†ä½“æ™ºæ…§â€ï¼Œè®©æ¨¡å‹æ‘†è„±äº†â€œå•ä¸€è§†è§’â€çš„é™·é˜±ã€‚å®ƒè®©æ¨¡å‹èƒ½å¤ŸåŒæ—¶æƒè¡¡å¤šç§ä¸åŒçš„è¯æ®å’Œçº¿ç´¢ï¼Œä»è€Œå¯¹è¯­è¨€ä¸­çš„ç»†å¾®å·®åˆ«å’Œå¤æ‚æ„å›¾ï¼Œåšå‡ºæ›´é²æ£’ã€æ›´ç²¾å‡†çš„ç†è§£ã€‚



# ä½ç½®ç¼–ç  
Attentionéƒ¨åˆ†è¿˜æœ‰æœ€åä¸€ä¸ªæœªè§£å†³çš„é—®é¢˜ï¼š

å¦‚æœæˆ‘ä»¬å°†â€œæˆ‘æ‰“ä½ â€é€è¿›å»ï¼Œå¾—å‡ºå¥å­å‘é‡Aï¼Œ
å°†â€œä½ æ‰“æˆ‘â€é€è¿›å»ï¼Œå¾—å‡ºå¥å­å‘é‡Bï¼Œ

ä¼šå‘ç°ä¸¤è€…ä¸€æ¨¡ä¸€æ ·ã€‚

æ˜¯çš„ï¼Œä¸Šæ¬¡å‡ºç°è¿™ä¸ªæƒ…å†µè¿˜æ˜¯Word2Vecæ¨¡å‹äº§å‡ºçš„é™æ€è¯å‘é‡ã€‚

å’¦ï¼Œé‚£RNNå’ŒLSTMè§£å†³çš„è¯­åºé—®é¢˜ï¼Œattentionæ²¡æœ‰è§£å†³ï¼Ÿ

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

å› ä¸ºQ @ K.Tè¿™ä¸ªæ ¸å¿ƒè¿ç®—ï¼Œåªå…³å¿ƒâ€œå“ªäº›è¯å‡ºç°äº†â€ï¼Œè€Œå®Œå…¨å¿½ç•¥äº†â€œå®ƒä»¬åœ¨å“ªä¸ªä½ç½®å‡ºç°â€ã€‚

å¾ªç¯ç¥ç»ç½‘ç»œå€ŸåŠ©å…¶â€œé¡ºåºè¯»å…¥â€çš„æœºåˆ¶ï¼Œå¤©ç„¶åœ°åŒ…å«äº†è¯­åºä¿¡æ¯ã€‚è€Œå®Œå…¨å¹¶è¡Œçš„Attentionï¼Œåˆ™å½»åº•æŠ›å¼ƒäº†å®ƒã€‚

**æˆ‘ä»¬å¿…é¡»ä¸ºAttentionï¼Œæ‰¾å›å®ƒä¸¢å¤±çš„â€œå¯¹è¯­åºçš„å¤„ç†â€ã€‚**Â 

è¿™å°±æ˜¯**ä½ç½®ç¼–ç **çš„ä½¿å‘½ï¼

ç”¨ä»€ä¹ˆæ¥è¡¨ç¤ºâ€œä½ç½®â€ï¼Ÿ

å—¯...  1ï¼Œ 2ï¼Œ 3ï¼Œ 4...  æˆ‘ä»¬ç›´æ¥æŠŠâ€œç¬¬nä¸ªæ•°â€œçš„nï¼ŒåŠ åˆ°è¯å‘é‡é‡Œé¢ï¼Œä¸èƒ½è¡¨ç¤ºå—ï¼Ÿ

ä¸è¡Œï¼š
- æ•°å€¼çˆ†ç‚¸ï¼šå½“å¥å­é•¿åº¦åˆ°500ï¼Œè¦åœ¨ç¬¬500ç»´+æ•°å­—500ï¼Œé€ æˆæ•´ä¸ªå¥å­å‘é‡æ•°å€¼çš„ä¸ç¨³å®šï¼Œè¿™æ ·ä¼šä¸¥é‡ä¸¢å¤±è¯­ä¹‰ã€‚
- æ— æ³•æ³›åŒ–ï¼šå‡å¦‚è®­ç»ƒåªç”¨äº†é•¿åº¦æœ€é•¿512çš„å¥å­ï¼Œä½†å®é™…ä½¿ç”¨æ—¶ï¼Œè¾“å…¥äº†513çš„å¥å­ï¼Œæ­¤æ—¶åŠ å…¥æ•°å­—513ï¼Œæ¨¡å‹çœ‹ä¸æ‡‚è¿™ä¸ªæ•°å­—ä»£è¡¨å•¥ï¼Œä»–ä¸æ˜ç™½è¿™æ˜¯512çš„ä¸‹ä¸€ä¸ªæ•°å­—ï¼æ¨¡å‹åœ¨è¿™ä¸ªå±‚é¢æ²¡æœ‰èƒ½åŠ›æ¨ç†ï¼


## ä½ç½®ç¼–ç ç›´è§‰å»ºç«‹
åŸè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯**sinå’Œcoså‡½æ•°**ï¼Œä¸€ä¸ªå¤©æ‰èˆ¬çš„è®¾è®¡ã€‚

å®ƒåŒæ—¶è§£å†³äº†ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œå¹¶å¸¦æ¥äº†é¢å¤–çš„å¥½å¤„ã€‚

**å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæˆ‘ä»¬ä¸ç”¨å•ä¸€çš„æ•°å­—æ¥è¡¨ç¤ºä½ç½®ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªç‹¬ç‰¹çš„â€œé¢‘ç‡ç»„åˆâ€æ¥è¡¨ç¤ºæ¯ä¸ªä½ç½®ã€‚**

æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¯å‘é‡çš„ç»´åº¦æ˜¯512ç»´ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªä½ç½®ï¼ˆpos=0, 1, 2...ï¼‰éƒ½ç”Ÿæˆä¸€ä¸ª512ç»´çš„**ä½ç½®å‘é‡**ã€‚è¿™ä¸ªå‘é‡çš„**æ¯ä¸€ä¸ªç»´åº¦Â i**ï¼Œéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹å®šçš„ä¸‰è§’å‡½æ•°å…¬å¼ç®—å‡ºæ¥çš„

- **å¶æ•°ç»´åº¦ (2i):**Â $PE(pos, 2i) = sin(\frac{pos} {10000^{2i/d_{model} } })$
- **å¥‡æ•°ç»´åº¦ (2i+1):**Â $PE(pos, 2i) = cos(\frac{pos} {10000^{2i/d_{model} } })$


è¿™æ ·ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªä½ç½®ï¼Œéƒ½ç”Ÿæˆäº†ä¸€ä¸ªé«˜ç»´åº¦çš„å‘é‡ï¼Œåœ¨æŸä¸€ä½ç½®çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªç»´åº¦å€¼éƒ½ä¸ä¸€æ ·ï¼Œåœ¨å…¨å±€çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªä½ç½®çš„é«˜ç»´å‘é‡ä¹Ÿéƒ½ä¸ä¸€æ ·ï¼

æˆ‘ä»¬å…ˆä¸æ¢ç©¶ä¸ºä»€ä¹ˆå…¬å¼è®¾è®¡æˆè¿™æ ·ï¼Œæˆ‘ä»¬å…ˆçœ‹è¿™æ ·çš„ä½ç½®ç¼–ç å…¬å¼å¸¦æ¥çš„æ•ˆæœã€‚

ä¸‹é¢æˆ‘ä»¬ç”¨ç”Ÿæˆçš„å›¾ï¼Œæ¥è¯¦ç»†çœ‹çœ‹ä½ç½®ç¼–ç 
![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761297593964.jpeg)
								`å›¾ï¼šä½ç½®å‘é‡çŸ©é˜µ`

**è¿™å¹…å›¾ï¼Œå¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è§£è¯»**

å…¶ä»–æ–‡ç« è¿™é‡Œéƒ½å¾ˆæ¨¡ç³Šï¼Œæˆ‘å»ºè®®å¤§å®¶å…ˆä»çºµå‘è§£è¯»è¿™å¼ å›¾ï¼

**1. çºµå‘è§£è¯»ï¼ˆå›ºå®šç»´åº¦iï¼Œè§‚å¯Ÿä½ç½®posçš„å˜åŒ–ï¼‰ï¼š**  

å†å»çœ‹çœ¼å…¬å¼å§ï¼å½“æˆ‘ä»¬å›ºå®šç»´åº¦æ—¶ï¼Œ
æ¯ä¸€åˆ—ï¼Œéƒ½æ˜¯ä¸€ä¸ª**æ ‡å‡†ã€è§„åˆ™çš„å…³äºposçš„å‘¨æœŸå‡½æ•°**ï¼ˆsinæˆ–cosæ³¢ï¼‰ã€‚

- åœ¨**å·¦ä¾§çš„åˆ—**ï¼ˆä½ä½ç»´åº¦ï¼‰ï¼Œé¢œè‰²ä»ä¸Šåˆ°ä¸‹å‰§çƒˆåœ°ã€å¿«é€Ÿåœ°äº¤æ›¿ï¼Œè¿™ä»£è¡¨ç€**é«˜é¢‘æ³¢**ï¼ˆå¤§å®¶å¯ä»¥å¸¦å…¥å°iï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‡½æ•°çš„é¢‘ç‡å¾ˆé«˜ï¼‰ã€‚å®ƒä»¬å¯¹åˆ†è¾¨ç›¸é‚»çš„ä½ç½®ï¼ˆæ¯”å¦‚pos=5å’Œpos=6ï¼‰æå…¶æ•æ„Ÿã€‚
- åœ¨**å³ä¾§çš„åˆ—**ï¼ˆé«˜ä½ç»´åº¦ï¼‰ï¼Œé¢œè‰²ä»ä¸Šåˆ°ä¸‹å‡ ä¹ä¿æŒä¸å˜ï¼Œè¿™ä»£è¡¨ç€**æä½é¢‘çš„æ³¢**ï¼ˆå¦‚æœ2iæ¥è¿‘d_modelï¼Œé‚£ä¹ˆé¢‘ç‡å¤§å°å°±æ¥è¿‘äº0ï¼‰ã€‚å®ƒä»¬ä¸ºæ¨¡å‹æä¾›äº†å…³äºä¸€ä¸ªè¯åœ¨å¥å­ä¸­â€œå¤§è‡´è½®å»“â€çš„ã€æå…¶ç¨³å®šçš„ä¿¡å·ã€‚

**2. æ¨ªå‘è§£è¯»ï¼ˆå›ºå®šä½ç½®posï¼Œè§‚å¯Ÿç»´åº¦içš„å˜åŒ–ï¼‰ï¼š**  
æ¯ä¸€è¡Œï¼Œéƒ½æ˜¯ä¸€ä¸ª**ç‹¬ä¸€æ— äºŒ**çš„â€œä½ç½®å‘é‡â€ã€‚

æ¯”å¦‚ç¬¬ä¸€è¡Œï¼Œå…¶å«ä¹‰å°±æ˜¯â€œå½“è¯çš„ä½ç½®åœ¨å¥å­ä¸­çš„ç¬¬ä¸€ä¸ªæ—¶ï¼Œå®ƒçš„ä½ç½®å‘é‡ï¼Œå„ç»´åº¦çš„å¤§å°æ˜¯å¤šå°‘ã€‚å…¶å¤§å°æˆ‘ä»¬ç”¨é¢œè‰²è¡¨ç¤ºâ€ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰ä¸€è¡Œæ˜¯ä¸€æ ·çš„ï¼ä¸”ä»å·¦åˆ°å³ï¼Œå…ˆæ˜¯å˜åŒ–å¿«ï¼Œå†æ˜¯å˜åŒ–æ…¢ã€‚

å…¶å®ï¼Œæˆ‘ä»¬ç»“åˆçºµå‘è§£è¯»æ¥çœ‹ï¼Œåœ¨ä½ç»´åŒºé—´ï¼Œç°‡æ‹¥ç€å¾ˆå¤šâ€œç«–çš„â€é«˜é¢‘å‡½æ•°ï¼Œè€Œæ¨ªç€çœ‹æ—¶ï¼Œæ˜¾ç„¶ä¼šè¢«è¿™äº›é«˜é¢‘å‡½æ•°å½±å“åˆ°ï¼Œå˜åŒ–å¾ˆå¿«ã€‚é«˜ç»´åŒç†ã€‚



æˆ‘ä»¬é€‰å–5ã€10ã€20ã€40å››ä¸ªä½ç½®å‘é‡ï¼Œè¯¦ç»†çœ‹çœ‹ä»–ä»¬çš„å€¼ï¼Œ

![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761308459800.jpeg)
å¯ä»¥çœ‹åˆ°ï¼Œå‰é¢éå¸¸...å‡Œä¹±ï¼Œä»-1åˆ°1ï¼Œæ¯ä¸ªç‚¹å‡ ä¹éƒ½ä¼šå–å€¼ã€‚

è€Œå¾€åï¼Œæ”¶æ•›åˆ°äº†å¥‡æ€ªçš„æƒ…å†µï¼Œæ‰€æœ‰æ›²çº¿å¥½åƒéƒ½...å˜ä¸€æ ·äº†ï¼Ÿ

ä»–ä»¬éƒ½åœ¨0ï¼Œ1è¿™ä¿©ä¸ªå€¼åå¤æ¨ªè·³ã€‚æˆ‘æ”¾å¤§ç»™å¤§å®¶çœ‹ï¼š

![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761308539338.jpeg)

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

è¯·å†çœ‹çœ‹å…¬å¼ï¼Œå½“2ié€¼è¿‘dmodelæ—¶ï¼Œsinå’Œcosé‡Œé¢çš„å€¼ï¼Œéƒ½æ˜¯è¶‹è¿‘äº0çš„ï¼

sin0å’Œcos0éƒ½æ˜¯å¤šå°‘å‘¢ï¼Ÿ  æœ‰æ²¡æœ‰â€œAhamomentâ€å‡ºç°ï¼

## å…¬å¼è¯¦è§£
ä¸‹é¢æˆ‘ä»¬å†å¥½å¥½æ¢ç©¶è¿™ä¸ªå…¬å¼ï¼Œ

- **å¶æ•°ç»´åº¦ (2i):**Â $PE(pos, 2i) = sin(\frac{pos} {10000^{2i/d_{model} } })$
- **å¥‡æ•°ç»´åº¦ (2i+1):**Â $PE(pos, 2i) = cos(\frac{pos} {10000^{2i+1/d_{model} } })$

æˆ‘ä»¬é€†å‘å·¥ç¨‹ä¸€ä¸‹ä½œè€…çš„æ€è·¯, å°½å¯èƒ½è¿˜åŸä½œè€…æ˜¯å¦‚ä½•æƒ³åˆ°çš„

1. **ç›®æ ‡Aï¼šæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½åŒºåˆ†ä¸åŒä½ç½®Â posÂ çš„æ–¹æ³•ã€‚**
    
    - **æ€è·¯ï¼š**Â æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯è®©ç¼–ç å€¼ä¸posæˆæ­£æ¯”ã€‚æ¯”å¦‚Â $f(pos) = C * pos$ã€‚
        
2. **ç›®æ ‡Bï¼šæˆ‘ä»¬éœ€è¦è®©ç¼–ç å€¼è¢«é™åˆ¶åœ¨ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´å†…ï¼ˆæ¯”å¦‚`[-1,1]`ï¼‰ï¼Œä¸èƒ½æ— é™å¢å¤§ã€‚**
    
    - **æ€è·¯ï¼š**Â ä»€ä¹ˆå‡½æ•°èƒ½æŠŠä¸€ä¸ªçº¿æ€§å¢é•¿çš„è¾“å…¥ï¼Œå˜æˆä¸€ä¸ªå‘¨æœŸæ€§çš„ã€æœ‰ç•Œçš„è¾“å‡ºï¼Ÿsinå’Œcoså‡½æ•°æ˜¯å®Œç¾çš„é€‰æ‹©ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡æ¼”å˜æˆäº†Â $f(pos) = sin(C * pos)$ã€‚
        
3. **ç›®æ ‡Cï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜ç»´å‘é‡ï¼Œè€Œä¸æ˜¯å•ä¸€æ•°å­—ï¼Œæ¥è¡¨ç¤ºä½ç½®ï¼Œä»¥é¿å…â€œä½ç½®å†²çªâ€ã€‚**
    
    - **æ€è·¯ï¼š**Â å¦‚æœåªç”¨ä¸€ä¸ªsinå‡½æ•°ï¼Œsin(Ï€)Â å’ŒÂ sin(2Ï€)Â çš„å€¼éƒ½æ˜¯0ï¼Œæˆ‘ä»¬å°±æ— æ³•åŒºåˆ†Ï€å’Œ2Ï€è¿™ä¸¤ä¸ªä½ç½®äº†ã€‚
        
    - **è§£å†³æ–¹æ¡ˆï¼š**Â æˆ‘ä»¬ä½¿ç”¨**ä¸åŒé¢‘ç‡**çš„sinå’Œcosæ³¢çš„ç»„åˆã€‚ç”¨d_modelä¸ªä¸åŒé¢‘ç‡çš„æ³¢ï¼Œæ¥ç»™ä¸€ä¸ªä½ç½®è¿›è¡Œâ€œæè¿°â€ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªä¸åŒä½ç½®ï¼Œåœ¨æ‰€æœ‰ç»´åº¦ä¸Šéƒ½å®Œå…¨ç›¸åŒçš„æ¦‚ç‡ï¼Œå°±å˜å¾—å¾®ä¹å…¶å¾®äº†ã€‚
        
    - **è®¾è®¡æ¼”å˜ï¼š**Â æˆ‘ä»¬çš„ç¼–ç ï¼Œå˜æˆäº†Â d_modelç»´çš„å‘é‡ï¼Œæ¯ä¸€ç»´Â iÂ éƒ½æœ‰è‡ªå·±çš„é¢‘ç‡Â $Ï‰_i$ã€‚  
        $PE(pos, i) = sin(Ï‰_i * pos)$

ä¸‹å›¾éå¸¸è¯¦ç»†åœ°å±•ç¤ºäº†ï¼Œå¥‡æ•°sinï¼Œå¶æ•°cosï¼Œå…±åŒç»„åˆæˆä½ç½®ç¼–ç å‡½æ•°çš„å«ä¹‰ï¼š

![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761307847543.jpeg)

![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761307851003.jpeg)
é€šè¿‡å°†ä¸€ä¸ªä½ç½®å‘é‡ï¼ˆè“è‰²å®çº¿ï¼‰â€œè§£å‰–â€æˆå…¶sinï¼ˆæ©™è‰²è™šçº¿ï¼‰å’Œcosï¼ˆç»¿è‰²ç‚¹çº¿ï¼‰ä¸¤ä¸ªåˆ†é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼Œé‚£æ¡çœ‹ä¼¼ä¸è§„åˆ™çš„æ›²çº¿ï¼Œå®é™…ä¸Šæ˜¯ç”±ä¸¤æ¡åŸºç¡€æ³¢å½¢**ç²¾ç¡®äº¤ç»‡**è€Œæˆçš„ã€‚
  
å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿåˆ†è§£ä¸€ä¸‹é«˜ç»´æƒ…å†µï¼Œä¹Ÿè®¸ä¹Ÿè§£å†³äº†ä½ å‰æ–‡çš„æŸäº›å›°æƒ‘ã€‚

![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761308919488.jpeg)


![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761308928081.jpeg)

å®é™…çš„ç»´åº¦éƒ½æ˜¯ç¦»æ•£çš„ç‚¹å“¦ï¼Œæˆ‘ä»¬ç”»çº¿åªæ˜¯ä¸ºäº†è¡¨è¾¾è¶‹åŠ¿ã€‚ ä½†æˆ‘ä»¬sinå’Œcosè¿™ç§è¿ç»­å‡½æ•°ï¼Œç”»å¯†é›†çš„ç‚¹æ˜¯æ²¡é—®é¢˜çš„ï¼Œä»”ç»†çœ‹sinå’Œcosåœ¨é‡‡æ ·ç‚¹éƒ½æ˜¯ä»€ä¹ˆå€¼ã€‚


4. **ç›®æ ‡Dï¼šæˆ‘ä»¬å¸Œæœ›è¿™äº›é¢‘ç‡Â Ï‰_iÂ èƒ½è¦†ç›–ä¸€ä¸ªå¹¿é˜”çš„èŒƒå›´ï¼Œä»éå¸¸é«˜é¢‘ï¼ˆèƒ½åˆ†è¾¨ç›¸é‚»è¯ï¼‰åˆ°éå¸¸ä½é¢‘ï¼ˆèƒ½ç¼–ç é•¿è·ç¦»å…³ç³»ï¼‰ã€‚**
    
    - **æ€è·¯ï¼š**Â æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œè®©é¢‘ç‡Ï‰_iéšç€ç»´åº¦içš„å¢åŠ è€Œå¹³æ»‘åœ°å˜åŒ–ã€‚
        
    - **æœ€ç®€å•çš„æƒ³æ³•ï¼š**Â è®©é¢‘ç‡Ï‰_i**çº¿æ€§**å˜åŒ–ã€‚æ¯”å¦‚Â $Ï‰_i = C * i$ã€‚
        
    - **æ›´å¥½çš„æƒ³æ³•ï¼š**Â è®©é¢‘ç‡Ï‰_iåœ¨**å¯¹æ•°ç©ºé—´**ä¸Šçº¿æ€§å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯**å‡ ä½•çº§æ•°**å˜åŒ–ã€‚è¿™æ ·èƒ½æ›´å‡åŒ€åœ°è¦†ç›–ä»çŸ­æ³¢åˆ°é•¿æ³¢çš„èŒƒå›´ã€‚
        
    - **è¿™å°±æ˜¯æœ€ç»ˆå…¬å¼çš„è¯ç”Ÿï¼**Â ä½œè€…é€‰æ‹©äº†Â $Ï‰_i = \frac{1} { 10000^{(\frac{2i}{d_{model}})}}$è¿™ä¸ªå…¬å¼ï¼Œæ­£æ˜¯ä¸€ä¸ªä»Â 1Â å¹³æ»‘åœ°ã€æŒ‰å‡ ä½•çº§æ•°é€’å‡åˆ°Â 1/10000Â çš„é¢‘ç‡åºåˆ—ã€‚


## æ€»ç»“ä¼˜åŠ¿
- ç”±äºsinå’Œcosçš„å‘¨æœŸæ€§ç»„åˆï¼Œæ¯ä¸ªä½ç½®ï¼ˆæ— è®ºå¤šé•¿ï¼‰éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„512ç»´å‘é‡
- æ— è®ºposæœ‰å¤šå¤§ï¼Œsinå’Œcosçš„è¾“å‡ºå€¼æ°¸è¿œè¢«**é™åˆ¶åœ¨`[-1, 1]`ä¹‹é—´**ã€‚è¿™å°±å®Œç¾åœ°è§£å†³äº†â€œæ•°å€¼çˆ†ç‚¸â€çš„é—®é¢˜ï¼Œå¯ä»¥å®‰å…¨åœ°ä¸è¯åµŒå…¥ç›¸åŠ ã€‚
- è•´å«â€ç›¸å¯¹ä½ç½®â€œä¿¡æ¯
	- è¿™ä¸ªå…¬å¼æœ‰ä¸€ä¸ªç¥å¥‡çš„æ•°å­¦ç‰¹æ€§ï¼šå¯¹äºä»»ä½•ä¸€ä¸ªä½ç½®posçš„ä½ç½®ç¼–ç ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ª**å›ºå®šçš„çº¿æ€§å˜æ¢**ï¼Œå¾—åˆ°pos+kï¼ˆæ¯”å¦‚pos+2ï¼‰çš„ä½ç½®ç¼–ç ã€‚
	- æ¨¡å‹ä¸éœ€è¦å»â€œæ­»è®°ç¡¬èƒŒâ€æ¯ä¸ªä½ç½®çš„ç»å¯¹ç¼–ç ã€‚å®ƒåªéœ€è¦å­¦ä¼šé‚£ä¸ªâ€œçº¿æ€§å˜æ¢â€ï¼Œå°±èƒ½**ç†è§£â€œå‘åç§»åŠ¨kæ­¥â€è¿™ä¸ªç›¸å¯¹æ¦‚å¿µã€‚
	- è¿™ä½¿å¾—æ¨¡å‹å…·æœ‰äº†æå¼ºçš„**æ³›åŒ–èƒ½åŠ›**ã€‚å³ä½¿å®ƒåœ¨è®­ç»ƒæ—¶åªè§è¿‡é•¿åº¦åˆ°512çš„å¥å­ï¼Œå½“é‡åˆ°ç¬¬
	 513ä¸ªè¯æ—¶ï¼Œå®ƒä¹Ÿèƒ½é€šè¿‡è¿™ä¸ªå­¦åˆ°çš„â€œç›¸å¯¹å…³ç³»â€ï¼Œç†è§£å®ƒä¸å‰é¢è¯çš„ä½ç½®å…³ç³»ã€‚

è¿™é‡Œä¸å…·ä½“è¯æ˜ä½ç½®ç¼–ç ä¸ºä»€ä¹ˆè•´å«ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œåˆ°æ—¶å€™ä¼šå¼€ä¸€ç¯‡æ–‡ç« è¯¦ç»†è®²è®²ä½ç½®ç¼–ç ã€‚
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä½ç½®ç¼–ç è•´å«ç›¸å¯¹ä½ç½®ä¿¡æ¯çš„â€œæ•ˆæœâ€ã€‚
![](../../../assets1/image/Transformerçš„æ ¸å¿ƒå¼•æ“ï¼šæ·±å…¥ç†è§£attentionæœºåˆ¶-1761309139033.jpeg)


å›¾ä¸­ï¼Œå…¨æ˜¯ä¸ä¸»å¯¹è§’çº¿å®Œå…¨å¹³è¡Œçš„ã€é¢œè‰²æ’å®šçš„æ¡çº¹
  
è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

çœ‹ä¸»å¯¹-è§’çº¿æ—çš„ç¬¬ä¸€æ¡æ–œçº¿ï¼ˆ`|i-j|=1`ï¼‰ï¼š å®ƒçš„é¢œè‰²æ˜¯æ’å®šçš„æ·¡é»„è‰²ã€‚è¿™è¯æ˜äº†ï¼Œä»»ä½•ä¸¤ä¸ªç›¸é‚»ä½ç½®ï¼ˆposä¸pos+1ï¼‰ä¹‹é—´çš„å‡ ä½•å…³ç³»ï¼Œéƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚

  
çœ‹ç¬¬äºŒæ¡æ–œçº¿ï¼ˆ|i-j|=2ï¼‰ï¼š å®ƒçš„é¢œè‰²æ˜¯æ’å®šçš„æµ…ç»¿è‰²ã€‚è¿™è¯æ˜äº†ï¼Œä»»ä½•ä¸¤ä¸ªç›¸éš”2ä¸ªä½ç½®çš„å‘é‡å¯¹ï¼Œå®ƒä»¬ä¹‹é—´çš„å‡ ä½•å…³ç³»ï¼Œä¹Ÿæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚

......ä»¥æ­¤ç±»æ¨ï¼

é€šè¿‡è¿™å¼ å›¾æˆ‘ä»¬å¾ˆæ¸…æ™°åœ°çœ‹è§ï¼Œä½ç½®ç¼–ç å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œåªå–å†³äºå®ƒä»¬çš„ç›¸å¯¹è·ç¦» |i - j|ï¼Œè€Œä¸å®ƒä»¬çš„ç»å¯¹ä½ç½® i å’Œ j æ— å…³ã€‚

è¿™å°±æ˜¯æ¨¡å‹èƒ½å¤Ÿå­¦ä¼šâ€œå‘åç§»åŠ¨kæ­¥â€è¿™ä¸ªé€šç”¨è§„åˆ™çš„æ ¹æœ¬åŸå› ã€‚è¿™å°±æ˜¯æ³›åŒ–èƒ½åŠ›çš„æ¥æºã€‚


### ä½œè€…çš„å°å£°å˜€å’•
æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œä½ç½®ç¼–ç é€šè¿‡å åŠ ä¸åŒé¢‘ç‡çš„sin/cosæ³¢ï¼Œä¸ºæ¨¡å‹æä¾›äº†å¤šå°ºåº¦çš„ä½ç½®åæ ‡ç³»ã€‚ä½†å®ƒçš„å½±å“ï¼Œå°¤å…¶æ˜¯å‰é¢é«˜é¢‘ï¼Œåé¢ä½é¢‘è¿™ç§æ¨¡å¼ï¼Œå…¶å½±å“å¯èƒ½æ¯”æˆ‘ä»¬æƒ³è±¡çš„æ›´ä¸ºæ·±è¿œã€‚

è¿™ç§ä»é«˜é¢‘åˆ°ä½é¢‘çš„ç»“æ„åŒ–è®¾è®¡ï¼Œå°±åƒä¸€ä¸ªâ€œæ¨¡æ¿â€ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¾ˆå¯èƒ½â€œ**è¯±å¯¼**â€äº†æ¨¡å‹å†…éƒ¨çš„è¯å‘é‡è¡¨ç¤ºï¼Œä¹Ÿå­¦ä¹ åˆ°äº†ç±»ä¼¼çš„åˆ†å·¥æ¨¡å¼ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè®­ç»ƒå¥½çš„Transformeræ¨¡å‹ï¼Œå…¶é«˜ç»´è¯å‘é‡ï¼ˆæ— è®ºæ˜¯è¯åµŒå…¥æœ¬èº«ï¼Œè¿˜æ˜¯Q, K, Vå‘é‡ï¼‰çš„**ä¸åŒç»´åº¦åŒºé—´ï¼Œå¯èƒ½å·²ç»è‡ªå‘åœ°å­¦ä¼šäº†ä¸“æ³¨äºä¸åŒå°ºåº¦çš„è¯­ä¹‰ä¿¡æ¯**ï¼šå‰åŠéƒ¨åˆ†æ›´å…³æ³¨å±€éƒ¨æ­é…ï¼ŒååŠéƒ¨åˆ†æ›´å…³æ³¨å…¨å±€ä¸»é¢˜ã€‚

è¿™ä¸æ˜¯ä¸€ä¸ªè¢«æ˜ç¡®å†™å…¥ä»£ç çš„è§„åˆ™ï¼Œè€Œæ˜¯åœ¨é™ä½æŸå¤±å‡½æ•°çš„"è¦æ±‚"ä¸‹ï¼Œâ€œæ¶Œç°â€å‡ºçš„ä¸€ç§å½±å“å’Œç‰¹ç‚¹ã€‚

è¿™ä¹Ÿè®¸å°±æ˜¯æ·±åº¦å­¦ä¹ çš„ç¾å§ï¼




# æ€»ç»“
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡å¯¹Attentionæœºåˆ¶çš„â€œæ·±åº¦è§£å‰–â€ã€‚

æˆ‘ä»¬ä»â€œ**å›¾ä¹¦é¦†æŸ¥é˜…**â€çš„ç›´è§‰å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ·±å…¥å…¶æ•°å­¦æ ¸å¿ƒï¼Œè§è¯äº†Query,Â Key,Â Valueå¦‚ä½•é€šè¿‡çŸ©é˜µè¿ç®—ï¼Œå®ç°é«˜æ•ˆçš„ä¿¡æ¯æ£€ç´¢ã€‚

æ¥ç€ï¼Œæˆ‘ä»¬ä¸ºattentionè¡¥å……ä¿©ä¸ªå…³é”®æ’ä»¶ï¼š
- **Cross-attention**ï¼šè®©å®ƒæ‹¥æœ‰äº†åœ¨ä¸åŒä¿¡æ¯æºï¼ˆå¦‚æ–‡æœ¬ä¸å›¾åƒï¼‰ä¹‹é—´å»ºç«‹å…³ç³»çš„èƒ½åŠ›ã€‚
- **Multi-Head Attention**ï¼Œåˆ™é€šè¿‡â€œé›†ä½“æ™ºæ…§â€ï¼Œè®©å®ƒæ‘†è„±äº†â€œå•ä¸€è§†è§’â€çš„é™·é˜±ï¼Œå­¦ä¼šäº†ä»å¤šä¸ªç»´åº¦è¿›è¡Œå¤æ‚ã€é²æ£’çš„å®¡è§†ã€‚

æœ€åï¼Œæˆ‘ä»¬ä¿®å¤äº†å®ƒå”¯ä¸€çš„ã€è‡´å‘½çš„è®¾è®¡ç¼ºé™·ã€‚é€šè¿‡æ³¨å…¥**ä½ç½®ç¼–ç **è¿™é“å……æ»¡æ•°å­¦ç¾æ„Ÿçš„æ ‡è®°ï¼Œæˆ‘ä»¬è®©attentionæ‰¾å›äº†å¯¹åºåˆ—é¡ºåºçš„æ„ŸçŸ¥ã€‚


è‡³æ­¤ï¼Œæˆ‘ä»¬æ‰‹ä¸­ï¼Œå·²ç»æ‹¥æœ‰äº†ä¸€ä»¶è¶³ä»¥æ’¼åŠ¨æ•´ä¸ªAIé¢†åŸŸçš„ã€å®Œæ•´çš„ã€å¯å¹¶è¡Œçš„æ ¸å¿ƒè®¡ç®—å•å…ƒã€‚ä»å¤§è¯­è¨€æ¨¡å‹å¯¹æ–‡æœ¬çš„æ·±å±‚ç†è§£ï¼Œåˆ°è§†è§‰å¤§æ¨¡å‹å¯¹å›¾åƒçš„ç²¾ç»†è§£æï¼Œå†åˆ°å¤šæ¨¡æ€æ¨¡å‹ä¸ºä¸åŒæ„Ÿå®˜ä¸–ç•Œæ­å»ºèµ·çš„æ²Ÿé€šæ¡¥æ¢â€”â€”è¿™ä¸€åˆ‡å¥‡è¿¹çš„èƒŒåï¼Œéƒ½é—ªè€€ç€Attentionæœºåˆ¶çš„èº«å½±ï¼

ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå°†æ˜¯Transformerä¸‰éƒ¨æ›²çš„æœ€ç»ˆç« ï¼Œæˆ‘ä»¬å°†è®¤è¯†å‰é¦ˆç¥ç»ç½‘ç»œã€æ®‹å·®è¿æ¥ã€å±‚å½’ä¸€åŒ–ï¼Œå°†é›¶ä»¶ç»„è£…æˆEncoderï¼ˆè´Ÿè´£æ·±åº¦é˜…è¯»ç†è§£çš„ç»“æ„ï¼‰,Decoderï¼ˆåœ¨encoderå¸®åŠ©ä¸‹ï¼Œè´Ÿè´£â€œæœ‰æ ¹æ®åœ°ã€ä¸€æ­¥æ­¥ç”Ÿæˆâ€çš„ç²¾å·§ç»“æ„ã€‚ å½“æˆ‘ä»¬å½»åº•ç†è§£äº†å®Œæ•´çš„Encoder-Decoderæ¶æ„åï¼Œå±Šæ—¶ï¼Œæ•´ä¸ªç°ä»£å¤§è¯­è¨€æ¨¡å‹çš„ä¸–ç•Œï¼Œéƒ½å°†ä¸ºä½ æ•å¼€å¤§é—¨ï¼




----
ç†è®ºçš„ç†è§£ï¼Œåªæœ‰åœ¨å®è·µä¸­æ‰èƒ½å¾—åˆ°æœ€ç»ˆçš„å‡åã€‚

ä¸ºäº†è®©æ‚¨èƒ½äº²æ‰‹è§¦æ‘¸åˆ°æˆ‘ä»¬æ–‡ä¸­æ‰€æ¢è®¨çš„æ¯ä¸€ä¸ªæ¦‚å¿µâ€”â€”ä»æ³¨æ„åŠ›ç‚¹ç§¯ï¼Œåˆ°äº¤å‰æ³¨æ„åŠ›ä¸å¤šå¤´æ³¨æ„åŠ›çš„ä½“ç°ï¼Œå†åˆ°äº²æ‰‹æ„Ÿå—ä½ç½®ç¼–ç çš„æ•ˆæœâ€”â€”æˆ‘ä¸ºæ‚¨å‡†å¤‡äº†ä¸€ä»½é…å¥—çš„ã€é€è¡Œæ³¨é‡Šçš„Jupyter Notebookã€‚

æ‚¨å°†åœ¨15åˆ†é’Ÿå†…ï¼Œäº²çœ¼è§è¯é—®é¢˜çš„å‘ç”Ÿã€å¥‡è¿¹çš„å‡ºç°ã€ä»¥åŠé­”æ³•çš„æ­ç§˜ã€‚

**æ‰€æœ‰ä»£ç å’Œæœªæ¥çš„æ›´æ–°ï¼Œéƒ½å·²åœ¨æˆ‘çš„å¼€æºé¡¹ç›®ã€LLMåŸºç¡€é”»é€ å‚ã€‘ä¸­å‘å¸ƒã€‚æ¬¢è¿æ‚¨Starã€Forkï¼Œå¹¶ä¸æˆ‘ä»¬ä¸€åŒè¸ä¸Šè¿™æ®µæ¿€åŠ¨äººå¿ƒçš„é”»é€ ä¹‹æ—…ã€‚**
> ğŸ‘‰ **[ç‚¹å‡»æ­¤å¤„ï¼Œç›´è¾¾GitHubä»“åº“ï¼Œè·å–æœ¬æ–‡çš„å®Œæ•´é…å¥—ä»£ç ](https://github.com/xduerkkkk/LLM-Foundations-Forge/tree/main)**
