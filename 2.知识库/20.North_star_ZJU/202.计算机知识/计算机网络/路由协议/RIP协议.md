**Routing Information Protocol**

一个由无数路由器组成的庞大网络，能够**自主地**、**协同地**解决一个核心问题：

> **“从我这里，到达网络中任何一个其他地方，最佳的路径是什么？”**



**核心思想：“我信任我的邻居告诉我的话”**

RIP协议的世界观非常单纯。一台路由器，它不关心整个网络的拓扑结构是怎样的。它只关心两件事：

1. **“距离 (Distance)”**：从我这里，到某个目的地，需要经过多少个路由器（我们称之为“**跳数 (Hop Count)**”）。跳数越少，路越好。
    
2. **“方向/矢量 (Vector)”**：要去那个目的地，我应该把数据包交给我的**哪个直接相邻的邻居**。
    

一台运行RIP协议的路由器，就像一个淳朴的村民。它获取信息的唯一方式，就是**定期地和自己的邻居们“唠嗑”**。

---

### **【一场“村委会”广播的开始】**

想象一个由A, B, C, D四台路由器（四个村民）组成的简单网络。

**初始状态：**

- 所有路由器刚刚启动。它们只知道自己直连的网络（就像每个村民只知道自己家门口的路）。
    
- 比如，A只知道：“要去网络N1，距离是1跳，直接从我自己的接口出去就行了。” 它的第一张路由表（地图）极其简单。
    

**第一次“广播/唠嗑”：**

1. **周期性交换**：RIP协议规定，每隔30秒，每个路由器都要把**自己脑中完整的路由表（它所知道的所有信息）**，像“村委会广播”一样，**广播给它所有的直接邻居**。
    
2. **A的广播**：A向它的邻居B广播：“嘿，B！这是我的地图：{到N1, 距离1}”。
    
3. **B的更新**：B收到了A的广播。它开始处理这个新信息：
    
    - **B的内心活动**：“哦？我的邻居A告诉我，他能到N1。从我这里到A，距离是1跳。那么，如果我通过A去N1，总距离就是 1 (我到A) + 1 (A到N1) = 2 跳。”
        
    - **查自己的地图**：B看了看自己的地图，发现自己根本不知道N1在哪。
        
    - **更新地图**：B立刻在自己的路由表里，增加了一条新路线：“**要去网络N1，下一跳交给A，总距离是2跳。**”
        

**第二次“广播/唠嗑”：**

1. 又过了30秒，所有路由器再次广播自己**更新后**的地图。
    
2. **B的广播**：这一次，B向它的邻居（比如A和C）广播了它更新后的地图：“嘿，各位！这是我的新地图：{到N2, 距离1}, {到N1, 距离2, 下一跳A}”。
    
3. **C的更新**：C收到了B的广播。它一看：“哇！我的邻居B能到N1！从我到B是1跳，B到N1是2跳，那我通过B去N1，总距离就是 1 + 2 = 3 跳！” 于是，C也更新了自己的地图。
    

这个“**定期分享，学习邻居**”的过程，会不断地进行下去。经过几轮“唠嗑”之后，网络中所有的路由器，最终都会“道听途说”出到达所有其他网络的路径。这个状态，我们称之为**“收敛 (Convergence)”**。








**场景**：假设网络已经“收敛”，所有路由器都有了完整的地图。突然，路由器A和网络N1之间的那条**链路断了！** A现在已经无法到达N1了。

根据我们刚才学习的RIP工作原理，您能推演出接下来会发生什么吗？

- A会如何更新自己的地图？
    
- 它的邻居B，在下一轮“唠嗑”中，会从A那里听到什么？又会从其他邻居（比如C）那里听到什么？
    
- B会相信谁的话？最终，B的地图会变成什么样子？


- A会把自己与N1的那个地图抹去
    
- B听到的地图里，根本没有N1 而听到C“别听A的！我能去N1，距离是3跳！而且，我是通过你（B）去的！” (C自己还不知道B去N1依赖于A)
    
- 哦？ B... B信谁的？信跳数少的，A是没跳数，所以信了C。这下C是错的，B也是错的


- 现在，让我们看看发生了什么：
    
    - B认为，要去N1，应该把包扔给**C**。
        
    - 而C的路由表里，依然写着，要去N1，应该把包扔给**B**！  
这个发生的情况就叫路由环路、无穷计数


# 如何解决

水平分割
- **水平分割**规则比您的想法更“霸道”和“简单粗暴”，也因此更高效。它的规则是：
    
    > **“我（一个路由器）从哪个接口学来的路由信息，就永远不会再从这个接口，把这条信息发回去了。”**
    
- **让我们来复盘这个规则如何打破循环**：
    
    1. 在灾难发生**之前**，B是通过A学到“如何去N1”的。
        
    2. B会将这条信息，广播给它的邻居C。
        
    3. C通过B学到了“如何去N1”。
        
    4. 现在，关键来了！当C下一次广播它的路由表时，根据“水平分割”规则，当它准备向B广播时，它会检查一下自己的路由表，发现“去N1”这条路，当初就是从B那里学来的。于是，**C在发给B的这份“地图”里，会主动地、技术性地“隐瞒”掉关于N1的任何信息！**
        
    5. **结果**：B**永远不会**从C那里，听到那个“我能通过你去N1”的致命谣言了！

### 【毒性反转 (Poison Reverse)】- “更强硬”的方式**

现在，我来揭晓您没想到的那个“更强硬的”方式。它通常与“水平分割”配合使用，被称为**毒性反转 (Poison Reverse)**，或**路由中毒 (Route Poisoning)**。

- **它是什么**：这是一种主动“**放毒**”的策略。
    
- **它的工作方式**：
    
    - 当A到N1的链路断掉时，A**不会**立即停止广播关于N1的信息。
        
    - 相反，它会立刻、主动地向所有邻居广播一条“**加急剧毒**”信息：“**紧急通知！现在去N1的距离，是无穷大（16跳）！**”
        
    - 这条“中毒”的路由信息，拥有**最高的优先级**。任何路由器收到这条“中毒”信息后，会**立即**更新自己的路由表，将对应条目标记为不可达，而**不是**去等待自己当前的路由慢慢超时。