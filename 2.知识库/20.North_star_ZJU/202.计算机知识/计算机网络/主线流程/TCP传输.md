# 三次握手
1. 客户端向服务器发送请求，这个请求以SYN（英文全称是 **Synchronize**）的形式发送，并告知初始序列号，序列号能蕴含数据包顺序这个信息。假设是X
2. 服务器回应客户端，发SYN+ACK（ACK是acknowledge？） 也有序列号，假设为Y。还有一个确认号，此时为X+1
3. 客户端发送ACK 是一个确认号  为Y+1
当服务器收到X 确认号就是X+1 意思是X号我收到了，下一次发X+1
- **对于确认号(ack)**：它是我对收到的最后一个包的**“签收回执”**，数值是我期望对方下一次发货的起始编号。
- **对于序列号(seq)**：它是我本次发货的**“发货单”**，数值是我自己这边数据流的延续。



### **【高清版：TCP三次握手作战图】**

**参与方：**
*   **客户端 (Client)**：我们的主机，主动发起连接请求。
*   **服务器 (Server)**：谷歌服务器，被动等待连接请求。

**核心概念回顾：**
*   **SYN (Synchronize)**: 一个“同步”标志位。SYN=1的包，是用来请求或同意建立连接的，**不能携带数据**，但**要消耗一个序列号**。
*   **ACK (Acknowledge)**: 一个“确认”标志位。ACK=1的包，表示这是一个确认信息。
*   **序列号 (Sequence Number, seq)**: 我方发送的数据的“起始编号”。
*   **确认号 (Acknowledgment Number, ack)**: 我期望对方**下一次**发送的数据的“起始编号”。

---

### **第一步：[SYN] 客户端 -> 服务器**

**“喂，在吗？我想和你建立连接。”**

1.  **客户端的动作**：
    *   客户端的TCP模块，准备发起连接。
    *   它会创建一个特殊的TCP报文段。
2.  **报文段内容 (关键字段)**：
    *   **SYN = 1**：将SYN标志位置为1，表明“这是一个连接请求”。
    *   **ACK = 0**：此时还没有任何需要确认的东西，所以ACK为0。
    *   **seq = x**：客户端随机选择一个初始序列号x。（比如 `seq=1000`）
    *   **ack = 0**：确认号无效。
3.  **发送**：客户端将这个`[SYN]`包发送给服务器。
4.  **状态变迁**：客户端的状态，从`CLOSED`变为`SYN-SENT`（同步已发送）。

---

### **第二步：[SYN+ACK] 服务器 -> 客户端**

**“在的！我同意连接。你听到我说话了吗？”**

1.  **服务器的动作**：
    *   服务器的TCP模块，收到了客户端的`[SYN]`包。
    *   如果服务器同意建立连接，它会创建一个响应的TCP报文段。
2.  **报文段内容 (关键字段)**：
    *   **SYN = 1**：我也要同步我的序列号，所以SYN也是1。
    *   **ACK = 1**：为了确认客户端的请求，ACK必须是1。
    *   **seq = y**：服务器也随机选择一个自己的初始序列号y。（比如 `seq=5000`）
    *   **ack = x + 1**：这是**关键**！服务器的确认号，必须是客户端的序列号`x`加1。这等于在说：“**你刚才那个编号为x的SYN包，我已经收到了。我期待你下一个发来的，是编号为x+1的数据。**”（`ack=1001`）
3.  **发送**：服务器将这个`[SYN+ACK]`包发送给客户端。
4.  **状态变迁**：服务器的状态，从`LISTEN`变为`SYN-RCVD`（同步已接收）。

---

### **第三步：[ACK] 客户端 -> 服务器**

**“听到了！连接正式建立。我们开始吧！”**

1.  **客户端的动作**：
    *   客户端的TCP模块，收到了服务器的`[SYN+ACK]`包。
    *   它检查服务器发来的`ack`号是否等于`x+1`，确认无误。
    *   它现在知道，双方的收发通道都是通畅的。于是，它创建最后一个确认包。
2.  **报文段内容 (关键字段)**：
    *   **SYN = 0**：连接已经建立，不再需要同步了。
    *   **ACK = 1**：这是一个确认包。
    *   **seq = x + 1**：这是**关键**！客户端现在发送的序列号，是它上一次发送的序列号`x`的延续，所以是`x+1`。（`seq=1001`）
    *   **ack = y + 1**：这也是**关键**！客户端的确认号，必须是服务器的序列号`y`加1。这等于在说：“**你刚才那个编号为y的SYN+ACK包，我也收到了。我期待你下一个发来的，是编号为y+1的数据。**”（`ack=5001`）
3.  **发送**：客户端将这个`[ACK]`包发送给服务器。
4.  **状态变迁**：
    *   客户端发送完ACK后，它的状态变为`ESTABLISHED`（连接已建立）。此时，它可以**开始发送真正的业务数据**（比如HTTP请求）了。
    *   服务器收到这个ACK后，检查`ack`号是否等于`y+1`，确认无误。它的状态也变为`ESTABLISHED`。
