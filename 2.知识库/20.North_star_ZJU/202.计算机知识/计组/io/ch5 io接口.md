# io结构

数据寄存器
状态寄存器
控制寄存器


# io编址

- 统一：io 设备的地址和主存地址放一块，统一管理，所以请求 io 设备地址的命令和正常命令别无二致，但是缺点是占用了主存的空间
- 独立：单独给 io 设备开个空间存储地址，想要访问就得有特殊命令
io软件
：三个层次
- 与操作系统无关的io库：如stdio（print... scanf）
- 与设备无关的操作系统调用库：如 read，close
- 设备驱动：访问 io 设备各个寄存器
io分类
- 并行接口，穿行接口：
- 可编程接口，不可编程接口
- 通用接口，不通用接口
- 同步接口，异步接口
- 直接传送方式，程序控制方式，


# 数据查询


# 数据传输控制方式
- 程序控制方式
- 程序中断控制
- 直接存储器访问方式（Direct Memory Access）

程序控制方式：
cpu 发出读指令后，不断询问，或定时询问 io 设备状态寄存器，一旦发现 io 设备就绪了，就开始处理数据寄存器上的数据

程序中断控制：cpu 发出读指令后，就自己干其他活去了。io 设备准备好数据，打电话通知 cpu，cpu 再放下手头的活处理


中断概念：可见程序中断控制中，cpu 并不是定死一个设备的。cpu 发完指令会干自己的活，那先干哪个活呢？即，如果有多个设备准备好了，cpu 先去处理谁呢？或者说如果出现故障了，cpu 先处理哪个故障呢？ 这些信息（准备好或故障）称为中断信号

中断类型
- 内部异常与外部中断
- 硬件中断和软件中断
- 自愿中断和强迫中断
- 可屏蔽中断和不可屏蔽中断
- 向量中断和非向量中断
- 单级中断和多级中断


中断屏蔽技术
每个设备都有自己的中断屏蔽字，“1”代表屏蔽，“0”代表允许

中断优先级
- 响应优先级
- 处理优先级
举例，同时来三个信号，实际是由“响应优先级”之间决定 cpu 先理谁的，但是，由于“中断屏蔽字”的存在，最终处理的顺序可能并不与响应优先级相同，最终处理的顺序就叫处理优先级。所以如果没有中断屏蔽技术，响应优先级就是处理优先级。

中断响应过程
- 关中断
- 保存断点
- 中断识别
     - 通过识别中断源得到中断号，中断号来计算得到中断向量地址
     - 访问向量表（包含中断服务程序地址和程序状态）

# 做题问题记录

定时中断服务开销需要 400 时钟周期，意思是 cpu 开启定时轮询时，自己加载 400t
屏蔽字中，1 代表屏蔽。所以 1 越多越牛逼，但是自己对自己也是 1 哦

| **方式**      | **CPU占用** | **速度** | **适用场景**    |
| ----------- | --------- | ------ | ----------- |
| **DMA**     | 极低        | 高速     | 硬盘、网卡、显卡等   |
| **PIO**     | 高         | 低速     | 传统IDE硬盘、键盘  |
| **中断驱动I/O** | 中         | 中速     | 串口、鼠标、USB设备 |
CPU占用率，一般分母为 1

主机与设备“串行工作”or“并行工作”:
只有轮询是串行，中断和 dma 都是并行，因为 cpu 能干活嘛，“并行干活”

键盘输入过程中，每按一次键，一定会产生中断请求；计算结果溢出不一定会中断请求
除了键盘，以下情况也会触发中断：

|**中断类型**|**触发场景**|
|---|---|
|**硬件中断**|外设请求服务（如硬盘读写完成、网卡收到数据包、鼠标移动、定时器到期）。|
|**异常（Exception）**|CPU执行非法操作（如除零、缺页故障、非法指令）。|
|**软件中断**|程序主动调用（如Linux的 `int 0x80` 系统调用、Windows的API调用）。|
|**DMA中断**|DMA传输完成后通知CPU（如SSD数据读取完毕）。|

## 如何判断是否需要中断？

- **是否需要CPU立即处理？**
    - 是 → 用中断（如键盘输入需实时响应）。
    - 否 → 用轮询或DMA（如批量硬盘读写）。
- **是否是异步事件？**
    - 外设随时可能发生的事件（如网络包到达）→ 中断。
    - 同步操作（如CPU计算）→ 无需中断。

**中断向量地址 = 中断服务程序入口地址在中断向量表中的存储位置**。 换句话说：

- **中断向量地址**是中断向量表中某个表项的**内存地址**（如`0x00000010`）。
- **中断服务程序入口地址**是该表项中**存储的值**（如`0x8000ABCD`，指向实际的ISR代码）

dma 中，周期窃取是窃取一个存取周期

设备与主机交换信息的方式中，中断方式的特点是：
    cpu 与设备并行工作，传送与主程序串行工作
设备与主机交换信息的方式中，dma的特点是：
    cpu 与设备并行工作，传送与主程序并行工作

i/o 编制方式是统一编址时，存储单元和 i/o 设备都是相同地址线，用不同地址码区分的

访存指令针对统一编址，输入输出指令针对独立编址
## 中断过程
中断服务程序的最后一条指令是中断返回指令

硬件，保存环境（pc，psw），关中断，软件上，压栈cpu 保存现场（保存刚干的活）-》isr，跳转中断服务程序并执行-》出栈，先把原理的环境弄好，恢复现场-》开中断-》中断返回指令，跳回源程序。出栈与中断返回指令不可调换的原因是，先中断返回，眼前没有“出栈才能看到的程序”，导致 cpu 不知道做什么

硬件中，cpu 会先执行自动保存断点、关中断，称为**中断隐指令**

中断发生时，程序计数器内容的保护和更新，置“0”允许中断触发器是由“硬件自动”完成的
## 数据传输
数据传输速率除了 bps 的单位还有哪些单位，如何计算
波特率是所有数据，比特率是有效数据
21 题，35 题-41题 55-60

程序中断方式和DMA方式中<span style="background:rgba(173, 239, 239, 0.55)">都有中断请求</span>，但目的不同
d'ma 只在处理结束的时候通知 cpu

霸道一点的是停止 cpu 访问，温柔一点是获得请求，然后使用周期挪用

dma 访问内存时，停止 cpu 访问主存和周期挪用两个概念有啥不一样，不都是 cpu 不工作吗



已知存储器容量，已知像素分辨率，问像素最多多少种不同颜色？为什么最后计算是 2 的多少多少次方？什么叫颜色深度？


什么叫中断服务程序？什么叫它的入口 ？什么叫中断向量地址？中断都有哪些指令？开中断关中断保存中断... 等等是什么，发生在什么时候

程序计数器（PC）的内容是被中断程序的尚未执行的指令地址，程序状态字寄存器（PSW）保存各种状态信息。CPU响应中断后，需要保护中断的CPU现场。将PC和PSW压入堆栈，等到中断结束后，将堆栈中的PC和PSW的内容返回相应的寄存器，原程序从断点开始继续执行。

中断响应发生在一条指令执行结束后，dma 响应发生在一个总线事务完成后
中断完关程序计数器。程序状态字寄存器都是啥意思
命令字，状态字，中断类型号都是啥
多重中断系统是啥？