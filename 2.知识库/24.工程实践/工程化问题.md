# jupyter环境
`pwd` 查看当前


```
VLM_from_scratch/
├── dataset/
│   └── vlmdataset.py
├── model/
│   ├── my_vlm.py
│   └── my_llm.py
└── 01_pretrain.ipynb
```
当你在01_pretrain.ipynb里写 from dataset.vlmdataset import ... 时，Python解释器会把 dataset 文件夹当作一个**“包 (Package)”**来处理。

在现代Python中（Python 3.3+），要让一个文件夹被识别为一个包，最规范的做法是**在文件夹内部包含一个空的 __init__.py 文件**。虽然从Python 3.3开始，隐式命名空间包（Implicit Namespace Packages）被引入，不再强制要求__init__.py，但在很多情况下（特别是在Jupyter这种环境中），缺少__init__.py仍然是导致模块找不到问题的常见原因。
# 技术报告哪里找？


# conda和pip

1. **先用conda安装“重的”：** 永远优先使用conda install来安装那些复杂的、有非Python依赖的包（PyTorch, TensorFlow, Spacy, Cudatoolkit等）。
    
2. **再用pip安装“轻的”：** 在conda完成工作后，再使用pip install -r requirements.txt来安装剩余的、纯Python的、或者Conda源里没有的包。

# 我怎么自己判断能不能跑模型 就不用每次的都问了
- 基础显存 = 模型大小 × 1.2~1.5
- 安全运行 = 基础显存 + 1~2GB 余量

# 一些工具命令
查看本地huggingface cache里的模型
huggingface-cli cache list
huggingface-cli scan-cache
# pip
pip install --upgrade

# Huggingface token
| 问题                               | 回答                                        |
| -------------------------------- | ----------------------------------------- |
| `huggingface-cli logout` 会退出账户吗？ | ❌ 不会，只是清除了本地保存的 token                     |
| 清除后还需要重新登录吗？                     | ✅ 是的，如果你想访问私有资源                           |
| 如何查看当前 token？                    | 使用 `huggingface-cli whoami` 或 Python 脚本   |
| Windows 下 token 存储在哪里？           | `C:\Users\<用户名>\.cache\huggingface\token` |
# wsl连不上网
1. 确认是否为dns  ```

```
nslookup huggingface.co

```



### 2. 看能否 ping 通外网 IP

```
ping 8.8.8.8
```




```
#!/usr/bin/env bash echo "=== DNS ===" nslookup huggingface.co echo -e "\n=== Ping 8.8.8.8 ===" ping -c 2 8.8.8.8 echo -e "\n=== TCP 443 ===" timeout 5 bash -c "</dev/tcp/huggingface.co/443" && echo "443 OK" || echo "443 FAIL"
```











```
netstat -ano | findstr LISTENING | findstr :7890
netstat -ano | findstr LISTENING | findstr :1080
```
powershell里跑，能确定本地代理端口

在 **WSL 终端**里执行：

```
WIN_IP=$(awk '/nameserver/{print $2}' /etc/resolv.conf | head -n1)
echo "当前 resolv.conf 给的 IP：$WIN_IP"
```

大概率输出就是 `10.255.255.254`，这是 VPN 的“假 DNS”，**不能用来连代理端口**。

正确做法：让 WSL 访问 **Windows 虚拟网卡**的 IP，通常是 `172.*.*.1`（WSL2 默认网段）。  
一行命令拿到：

```
WIN_IP=$(ip route | grep default | awk '{print $3}')
echo "Windows 虚拟网卡 IP：$WIN_IP"
```

如果输出类似 `172.22.128.1`，这就是能通 7890 的地址。

设置允许局域网连接
```
# 1. 看 7890 端口是否真在 172.24.224.1 上监听
nc -vz 172.24.224.1 7890
```
172.24.224.1

最关键的
linux
```
export http_proxy=http://172.24.224.1:7890 
export https_proxy=http://172.24.224.1:7890
```
windows：
```
# 设置HTTP代理
netsh winhttp set proxy 127.0.0.1:1080

# 查看当前代理设置
netsh winhttp show proxy

set HTTP_PROXY=http://127.0.0.1:7890

set HTTPS_PROXY=https://127.0.0.1:7890
```

# vllm显存占用
1. **桌面环境**会大量占用GPU显存。
    
2. **推理框架**本身有显著的显存开销。
    
3. **内存碎片**和**总容量**共同决定了程序能否运行。


# autodl 连接
f1，remote connect 然后直接输入root@connect.nmb2.seetacloud.com 不用输入端口
# git操作
完整的，先在当前目录git init
然后关联仓库，
git remote add
然后git add .  是全部文件 也可以选，文件夹或者文件都可以？只要当前目录就行

git branch -M main  # 把main改名为master
git push origin main

然后git commit -m 写说明
git pull origin main

git reset --soft HEAD~1撤销

- 想**同步远端**用 `git pull`；
    
- 想**把本地推上去**用 `git add . && git commit && git push`
# 更好的技术操作
###  .view().transpose() vs. .reshape()

这是一个非常微妙且重要的问题。在很多情况下，它们的效果**可能**一样，但背后的机制不同，并且使用 .view().transpose() 是**更安全、更规范**的做法。

- reshape(a, b, c, d): 这是一个非常直接的命令：“不管三七二十一，把数据给我重新排列成 a*b*c*d 的样子”。它可能会导致数据在内存中的顺序被打乱，从而改变了词与词之间的对应关系，这在我们的任务里是致命的。
    
- .view(..., self.h, self.d_k): 这个操作是把最后一个维度 d_model “切”成 h 份，每份 d_k。它保证了**每个词对应的 d_model 维向量被正确地切分**。
    
- .transpose(1, 2): 这个操作是把第1维（seq_len）和第2维（num_heads）进行交换。
    

**联合起来，.view().transpose() 这个组合技，精确地实现了我们想要的逻辑：先在每个词的内部把维度拆开，然后再把“头”这个维度提到前面来，整个过程词的顺序和对应关系是绝对正确的。** 因此，这是实现多头拆分时的标准做法。

在 **Jupyter Notebook** 中，你不能直接用 `export` 命令（因为 `export` 是 shell 命令，只在终端中有效），但你有 **多种方式** 来设置环境变量 `HF_TOKEN`，让 `os.getenv("HF_TOKEN")` 能正确读取。

---

## ✅ 正确方法：在 Jupyter 中设置 `HF_TOKEN`

### ✅ 方法 1：用 `os.environ` 直接设置（最常用）